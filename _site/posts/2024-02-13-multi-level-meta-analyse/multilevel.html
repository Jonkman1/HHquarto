<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Harrie Jonkman">
<meta name="dcterms.date" content="2024-02-14">
<meta name="description" content="Op dit moment begeleid ik een groep studenten bij het opstellen en afronden van hun masterthesis. Daarvoor moeten ze een meta-analyse uitvoeren. Mij is gevraagd toe te werken bijvoorbeeld naar een multilevel meta-analyse met moderatoren. Een mooie inleiding daarop is het hoofdstuk “Multilevel” meta-analyse uit het boek Doing Meta-Analysis in R van Harrer, Cuijpers, Furukawa, and Ebert (2021), dat ik daarom hier bewerkt heb. De komende tijd zal ik het hele boek als een notitieboek opzetten (een verkorte en samenvattende versie). Dit hoofdstuk is een aanzet daarvoor.">

<title>Multilevel meta-analyse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-3a1197cc0774821054ad3543cdc64272.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Harrie’s Hoekje</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Jonkman1"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Multilevel meta-analyse</h1>
                  <div>
        <div class="description">
          <p>Op dit moment begeleid ik een groep studenten bij het opstellen en afronden van hun masterthesis. Daarvoor moeten ze een meta-analyse uitvoeren. Mij is gevraagd toe te werken bijvoorbeeld naar een multilevel meta-analyse met moderatoren. Een mooie inleiding daarop is het hoofdstuk <em>“Multilevel” meta-analyse</em> uit het boek <em>Doing Meta-Analysis in R</em> van Harrer, Cuijpers, Furukawa, and Ebert (2021), dat ik daarom hier bewerkt heb. De komende tijd zal ik het hele boek als een notitieboek opzetten (een verkorte en samenvattende versie). Dit hoofdstuk is een aanzet daarvoor.</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">analyseren</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Harrie Jonkman </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 14, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#introductie" id="toc-introductie" class="nav-link active" data-scroll-target="#introductie">Introductie</a></li>
  <li><a href="#theorie" id="toc-theorie" class="nav-link" data-scroll-target="#theorie">Theorie</a></li>
  <li><a href="#praktijk" id="toc-praktijk" class="nav-link" data-scroll-target="#praktijk">Praktijk</a></li>
  <li><a href="#materialen" id="toc-materialen" class="nav-link" data-scroll-target="#materialen">Materialen</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introductie" class="level2">
<h2 class="anchored" data-anchor-id="introductie">Introductie</h2>
<p>Op dit moment begeleid ik een groep studenten bij het opstellen en afronden van hun masterthesis. Daarvoor moeten ze een meta-analyse uitvoeren over de relatie tussen ingrijpende jeugdervaring (Adversed Childhood Experiences (ACE’s)) en opvoeden. Mij is gevraagd toe te werken naar een multilevel meta-analyse met moderatoren, een methode waarbij rekening wordt gehouden met de afhankelijkheid van effect sizes (zie bv. Assink, Wibbelink, et al.&nbsp;2016) en de invloed van enkele onafhankelijke variabelen op de resultaten wordt meegenomen. Voor mijzelf was hierbij het hoofdstuk <em>“Multilevel” meta-analyse</em> uit het boek <em>Doing Meta-Analysis in R</em> van Harrer, Cuijpers, Furukawa, and Ebert (2021) zeer inzichtelijk.<br>
In dit hoofdstuk wordt gebruik gemaakt van de dataset uit de <code>Chernobyl</code>-studie van Møller en Mousseau (2015). In deze maatschappelijk zeer relevante studie wordt het effect van de straling die vrijkwam bij de Chernobyl ramp van 26 april 1986 op het aanpassingsniveau van diverse soorten onderzocht. Hiervoor werden 45 relevante studies betrokken die over in totaal 30 soorten onderzochten. Het overall effect van die straling op het aanpassingsniveau van de soorten was heel groot (<span class="math inline">\(E\)</span>=0.67; 95% CI: 0.59-0.73), waarbij het 44,3% van de totale variantie wegnam in een ongestructureerd random-effect model. Er bleek veel overlap tussen de soorten te zijn en de tijd veranderde de grootte van de effecten niet significant.<br>
Omdat het zo behulpzaam was heb ik het vertaald en bewerkt, waarbij een van de gepresenteerde methodes worden gebruikt (in het boek worden ook alternatieven geboden). De komende tijd zal ik het hele boek van Harrer et al.&nbsp;als een notitieboek opzetten. Dit hoofdstuk is een aanzet daarvoor met een of twee maanden zal het als blog hierverschijnen. Elk hoofdstuk wordt dan, net als dit hoofdstuk, verdeeld in enkele theoretische notities en een praktisch deel waarin getoond wordt hoe het werkt in <code>R</code>.</p>
<p><br></p>
</section>
<section id="theorie" class="level2">
<h2 class="anchored" data-anchor-id="theorie">Theorie</h2>
<p>Als mensen het over multilevel meta-analyse hebben, denken ze aan <strong>meta-analyse modellen op drie niveaus</strong>. In <em>Doing meta-analysis with R</em> beschrijven Harrer et al.&nbsp;waarom meta-analyse van nature al een multilevel structuur van de data heeft en laten ze zien hoe zo’n conventionele meta-analyse kan worden uitbreid naar een model op drie niveaus. Aan de hand van een praktijkvoorbeeld laten ze het zien hoe het werkt in <code>R</code>.</p>
<p>Ze gaan eerst terug naar de random-effects model formule die ons bekend is: Deze formule beschrijft dus eigenlijk al een multilevelstructuur van meta-analysegegevens. Om dit duidelijker te maken, wordt de vergelijking opgesplitst in twee formules, waarbij elke formule correspondeert met een van de twee niveaus. Als we dit doen, krijgen we het volgende resultaat:</p>
<p><strong>Niveau 1 (participanten) model:</strong></p>
<p><span class="math display">\[\hat\theta_k = \theta_k + \epsilon_k\]</span></p>
<p><strong>Niveau 2 (studies) model:</strong></p>
<p><span class="math display">\[\theta_k = \mu + \zeta_k\]</span></p>
<p>Dit oude-vertrouwde meta-analysemodel heeft de multilevel-eigenschap “ingebouwd”. Het heeft namelijk deze eigenschap omdat we aannemen dat deelnemers geclusterd zijn binnen studies in onze data. Het is nu mogelijk om deze twee-niveausstructuur verder uit te breiden om bepaalde mechanismen, die onze data hebben gegenereerd, beter vast te leggen. Dit is waar drie-niveaumodellen om de hoek komen kijken (Cheung 2014; Assink, Wibbelink, et al.&nbsp;2016).</p>
<p>Modellen met drie niveaus kunnen worden gebruikt voor afhankelijke effectgroottes. Wanneer een bepaalde studie bijvoorbeeld meer dan één effect sizes omvat, kunnen we er meestal niet vanuit gaan dat deze verschillende resultaten onafhankelijk zijn. Een drie niveaumodel ondervangt dit probleem door aan te nemen dat effect sizes geclusterd zijn binnen grotere clusters (in dit geval bijvoorbeeld studies).</p>
<p>Die model met drie niveau’s ziet er als volgt uit:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Screenshot2.png" class="img-fluid figure-img"></p>
<figcaption>Drie niveaustructuur</figcaption>
</figure>
</div>
<p>Het is mogelijk om de formule van dit model met drie lagen op te schrijven met dezelfde formules die we hierboven gebruikten. Het grootste verschil is dat we nu drie formules moeten definiëren in plaats van twee:</p>
<p><strong>Level 1 model:(participanten)</strong></p>
<p><span class="math display">\[\hat\theta_{ij} = \theta_{ij} + \epsilon_{ij}\]</span></p>
<p><strong>Level 2 model:(binnen studies)</strong></p>
<p><span class="math display">\[\theta_{ij} = \kappa_{j} + \zeta_{(2)ij}\]</span></p>
<p><strong>Level 3 model:(tussen studies)</strong></p>
<p><span class="math display">\[\kappa_{j} = \mu + \zeta_{(3)j}\]</span></p>
<p>Waarbij <span class="math inline">\(\hat\theta_{ij}\)</span> een schatting is van de ware effectgrootte <span class="math inline">\(\theta_{ij}\)</span>. De term <span class="math inline">\(ij\)</span> kan worden gelezen als “een effect size” <span class="math inline">\(i\)</span> geclusterd in cluster <span class="math inline">\(j\)</span>“. De parameter <span class="math inline">\(\kappa_{j}\)</span> is de gemiddelde effect size in cluster <span class="math inline">\(j\)</span>, en <span class="math inline">\(\mu\)</span> het totale gemiddelde populatie-effect. Net als voorheen kunnen we deze formules samenvoegen en zo de formule reduceren tot één regel:</p>
<p><span class="math display">\[\hat\theta_{ij} = \mu + \zeta_{(2)ij} + \zeta_{(3)j} + \epsilon_{ij}\]</span></p>
<p>In tegenstelling tot de conventionele meta-analyse (random-effects models) schatten modellen met drie niveau’s twee heterogeniteitsvarianties: de random-effectvariantie <em>binnen</em> clusters en de heterogeniteitsvariantie <em>tussen</em> clusters (de clusters zijn in dit geval studies). Het is ook mogelijk om categorische of continue voorspellers te testen met een model met drie niveaus. Dit resulteert in een mixed-effects model met drie niveaus.</p>
<p>Het boek bespreekt overigens ook andere methodes om met het geclusterde karakter van de data om te gaan (geCorreleerde en Hierarchisch Effenten model (CHE) en Robust Variance Estimation (RVE) modellen). Deze methodes worden echter hier niet verder uitgewerkt .</p>
</section>
<section id="praktijk" class="level2">
<h2 class="anchored" data-anchor-id="praktijk">Praktijk</h2>
<section id="voorbereiding" class="level3">
<h3 class="anchored" data-anchor-id="voorbereiding">Voorbereiding</h3>
<p>Het <strong>{metafor}</strong> pakket is heel geschikt om meta-analyse op drie niveau’s uit te voeren. Het gebruikt ‘(restricted) maximum likelihood’ (REML-) procedures als default om dat te doen.</p>
<p>We moeten eerst de biblitheek hiervan openen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wees er zeker van dat het pakket is geïnstalleerd</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(metafor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Voor hier gebruiken we de <code>Chernobyl</code> data set (gebaseerd op de studie van Möller en Mousseau, 2015). Die dataset is deel van het <code>dmetar</code> pakket waar meer datasets voor meta-analyse in zitten. Laten we <code>dmetar</code> en de dataset laden. Laten we meteen ook <code>tidyverse</code> laden, omdat we dat later nodig hebben voor databewerking.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wees er zeker van dat het pakket is geïnstalleerd</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dmetar)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Chernobyl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Laten we eens zien hoe de <code>Chernobyl</code> dataset eruit ziet.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Chernobyl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      author    cor   n         z       se.z       var.z
1 Aghajanyan &amp; Suskov (2009) 0.2061  91 0.2090949 0.10660036 0.011363636
2 Aghajanyan &amp; Suskov (2009) 0.2687  91 0.2754621 0.10660036 0.011363636
3 Aghajanyan &amp; Suskov (2009) 0.2049  92 0.2078420 0.10599979 0.011235955
4 Aghajanyan &amp; Suskov (2009) 0.2672  92 0.2738461 0.10599979 0.011235955
5     Alexanin et al. (2010) 0.9317 559 1.6711230 0.04240945 0.001798561
6     Alexanin et al. (2010) 0.4429 559 0.4758327 0.04240945 0.001798561
  radiation es.id
1       low  id_1
2       low  id_2
3       low  id_3
4       low  id_4
5       low  id_5
6       low  id_6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(Chernobyl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 33
Columns: 8
$ author    &lt;chr&gt; "Aghajanyan &amp; Suskov (2009)", "Aghajanyan &amp; Suskov (2009)", …
$ cor       &lt;dbl&gt; 0.2061, 0.2687, 0.2049, 0.2672, 0.9317, 0.4429, 0.8996, 0.95…
$ n         &lt;dbl&gt; 91, 91, 92, 92, 559, 559, 559, 559, 559, 559, 560, 15, 79, 9…
$ z         &lt;dbl&gt; 0.20909489, 0.27546213, 0.20784198, 0.27384610, 1.67112298, …
$ se.z      &lt;dbl&gt; 0.10660036, 0.10660036, 0.10599979, 0.10599979, 0.04240945, …
$ var.z     &lt;dbl&gt; 0.011363636, 0.011363636, 0.011235955, 0.011235955, 0.001798…
$ radiation &lt;chr&gt; "low", "low", "low", "low", "low", "low", "low", "low", "low…
$ es.id     &lt;chr&gt; "id_1", "id_2", "id_3", "id_4", "id_5", "id_6", "id_7", "id_…</code></pre>
</div>
</div>
<p>De data set omvat acht kolommen (variabelen) en 33 rijen (studies). De eerste, <code>author</code>, geeft de naam van het onderzoek weer. De kolom <code>cor</code> toont de (niet-getransformeerde) correlatie tussen stralingsblootstelling en mutatiepercentages, terwijl <code>n</code> staat voor de steekproefgrootte. De kolommen <code>z</code>, <code>se.z</code>, en <code>var.z</code> zijn de Fisher-<span class="math inline">\(z\)</span> getransformeerde correlaties, evenals hun standaardfout en variantie. De kolom <code>radiation</code> dient als moderator, die effectgroottes verdeelt in twee subgroepen, één met een lage en één met hoge totale stralingsblootstelling. De kolom <code>es.id</code> bevat eenvoudigweg een unieke ID voor elke effectgrootte (d.w.z. elke rij in ons dataframe).</p>
<p>Een eigenaardigheid aan deze dataset is dat er herhaalde (geclusterde) vermeldingen in de kolom <code>author</code> staan. Dit komt doordat de meeste studies in deze meta-analyse meer dan één waargenomen effectgrootte hebben bijgedragen. Als we naar deze structuur kijken, is het duidelijk dat effectgroottes in onze dataset niet onafhankelijk zijn. Ze volgen een geclusterde structuur, waarbij verschillende effectgroottes geclusterd zijn in één studie. Het zou dus een goed idee kunnen zijn om een meta-analyse op drie niveaus uit te voeren om deze afhankelijkheden in onze gegevens adequaat te modelleren.</p>
</section>
<section id="het-fitten-van-een-drie-niveau-ma-model" class="level3">
<h3 class="anchored" data-anchor-id="het-fitten-van-een-drie-niveau-ma-model">Het fitten van een drie niveau ma-model</h3>
<p>Een meta-analysemodel met drie niveaus kan worden uitgevoerd met de functie <code>rma.mv</code> in <strong>{metafor}</strong>. Hieronder vind je een lijst van de belangrijkste argumenten voor deze functie en hoe ze gespecificeerd moeten worden:</p>
<ul>
<li><p><code>yi</code>. De naam van de kolom in onze dataset die de berekende effectgroottes bevat. In ons voorbeeld is dit <code>z</code>, omdat Fisher-<span class="math inline">\(z\)</span> getransformeerde correlaties betere wiskundige eigenschappen hebben dan “niet-getransformeerde” correlaties.</p></li>
<li><p><code>V</code>. De naam van de kolom in onze gegevensverzameling is die de <strong>variantie</strong> van de berekende effectgroottes bevat. In ons geval is dit <code>var.z</code>. Het is ook mogelijk om de gekwadrateerde standaardfout van de effectgrootte te gebruiken, aangezien <span class="math inline">\(SE^2_k=vk\)</span>.</p></li>
<li><p><code>s.lab</code>. De naam van de kolom in onze dataset die de studielabels bevat.</p></li>
<li><p><code>data</code>. De naam van de data set.</p></li>
<li><p><code>test</code>. De test die we willen toepassen op onze regressiecoëfficiënten. We kunnen kiezen uit <code>"z"</code> (standaard) en <code>"t"</code> (aanbevolen; gebruikt een test vergelijkbaar met de Knapp-Hartung methode).</p></li>
<li><p><code>methode</code>. De methode die wordt gebruikt om de modelparameters te schatten. Zowel <code>"REML"</code> (aanbevolen; restricted maximum-likelihood) als <code>"ML"</code> (maximum likelihood) zijn mogelijk. Hou er rekening mee dat andere soorten heterogeniteitsschattingen tussen studies (bijv. Paule-Mandel) hier niet van toepassing zijn.</p></li>
<li><p><code>random</code>. De naam van de kolom die hier het belangrijkst is. de algemene structuur van de formule ziet er als volgt uit: <code>~ 1 | cluster/effecten_binnen_cluster</code>. Hier gaan we uit van een structuur met drie niveaus: individuen (niveau 1), individuele effectgroottes (niveau 2) en studies (niveau 3), dus krijgen we de formule <code>~ 1 | author/es.id</code>.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>full.model <span class="ot">&lt;-</span> <span class="fu">rma.mv</span>(<span class="at">yi =</span> z, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">V =</span> var.z, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">slab =</span> author,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> Chernobyl,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> author<span class="sc">/</span>es.id, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">test =</span> <span class="st">"t"</span>, </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">"REML"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>De resultaten van dit multilevel model kun je vervolgens krijgen door <code>summary</code> functie in te tikken:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Multivariate Meta-Analysis Model (k = 33; method: REML)

  logLik  Deviance       AIC       BIC      AICc   
-21.1229   42.2458   48.2458   52.6430   49.1029   

Variance Components:

            estim    sqrt  nlvls  fixed        factor 
sigma^2.1  0.1788  0.4229     14     no        author 
sigma^2.2  0.1194  0.3455     33     no  author/es.id 

Test for Heterogeneity:
Q(df = 32) = 4195.8268, p-val &lt; .0001

Model Results:

estimate      se    tval  df    pval   ci.lb   ci.ub      
  0.5231  0.1341  3.9008  32  0.0005  0.2500  0.7963  *** 

---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Kijk naar de<code>Variance Components</code>:<br>
- <code>sigma^2.1</code> toont de variantie op niveau 3 (variantie tussen clusters). Dit komt overeen met de heterogeniteitsvariantie tussen studies <span class="math inline">\(tau^2\)</span> van een conventionele meta-analyse (aangezien de clusters <code>author</code> (14 stuks in totaal) in ons model studies vertegenwoordigen). Dit is gelijk aan 33 effectgroottes (<code>author/es.id</code>) en de heterogeniteitsvariantie binnen studies.<br>
- Onder <code>Modelresultaten</code> zien we de schatting van ons gepoolde effect (<span class="math inline">\(z=\)</span> 0.52 (95%CI: 0.25-0.80)). Om de interpretatie te vergemakkelijken, is het raadzaam om het effect terug te transformeren naar een normale correlatie.</p>
<p>Dit laatste kan worden gedaan met de functie <code>convert_z2r</code> in het pakket <strong>{esc}</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(esc)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">convert_z2r</span>(<span class="fl">0.52</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4777</code></pre>
</div>
</div>
<p>We zien dat dit leidt tot een correlatie van ongeveer $<span class="math inline">\(0,48. Dit kan als groot worden beschouwd. Er lijkt een substantieel verband te zijn tussen mutatiepercentages en blootstelling aan straling van Tsjernobyl. De `Test voor Heterogeniteit` in de uitvoer wijst op echte effectgrootteverschillen in onze gegevens (\)</span>p$&lt;0,001). Dit resultaat is echter niet erg informatief. We zijn meer geïnteresseerd in de precieze hoeveelheid heterogeniteitsvariantie die door elk niveau in ons model wordt gevangen. Het zou goed zijn om te weten hoeveel van de heterogeniteit wordt veroorzaakt door verschillen tussen participanten (niveau 1), binnen studies (niveau 2) en hoeveel door verschillen tussen studies (niveau 3).</p>
</section>
<section id="variantie-die-aan-elk-niveau-is-toe-te-schrijven." class="level3">
<h3 class="anchored" data-anchor-id="variantie-die-aan-elk-niveau-is-toe-te-schrijven.">Variantie die aan elk niveau is toe te schrijven.</h3>
<p>In modellen met drie niveaus wordt deze heterogeniteitsvariantie in drie delen gesplitst: individuele verschillen, een deel dat kan worden toegeschreven aan echte effectgrootteverschillen binnen clusters en een deel dat kan worden toegeschreven aan variatie tussen clusters. Er zijn dus drie <span class="math inline">\(I^2\)</span> waarden, die het percentage van de totale variatie kwantificeren dat is geassocieerd met niveau 1, niveau 2 of niveau 3. De <code>var.comp</code> functie heeft alleen een passend <code>rma.mv</code> model als invoer nodig. We slaan de uitvoer op in <code>i2</code> en gebruiken dan de functie <code>summary</code> om de resultaten af te drukken.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>i2 <span class="ot">&lt;-</span> <span class="fu">var.comp</span>(full.model)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(i2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        % of total variance    I2
Level 1            1.254966   ---
Level 2           39.525499 39.53
Level 3           59.219534 59.22
Total I2: 98.75% </code></pre>
</div>
</div>
<p>No variance(niveau 1), binnen-variantie (niveau 2) is bijna <span class="math inline">\(40\%\)</span> en de tussen-variantie (level 3) is bijna <span class="math inline">\(60\%\)</span>.</p>
<p>We kunnen dit visualiseren door het <code>i2</code> object in de <code>plot</code> functie te zetten.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(i2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="multilevel_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Is een model met drie niveaus eigenlijk wel nodig? Hiervoor moeten we het drie-niveau model vergelijken met een twee-niveau model. Die vergelijking kunnen we doen met behulp van de functie <code>anova</code>. Laten we eerst een tweeniveaumodel maken. Dat doen we door onder <code>method = "REML"</code> de optie <code>sigma2 = c(0, NA)</code> toe te voegen. Dit betekent dat we de variantie op niveau 3 op 0 zetten en het oorspronkelijk meta-analyse model overblijft.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>l3.removed <span class="ot">&lt;-</span> <span class="fu">rma.mv</span>(<span class="at">yi =</span> z, </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">V =</span> var.z, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">slab =</span> author,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> Chernobyl,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> author<span class="sc">/</span>es.id, </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">test =</span> <span class="st">"t"</span>, </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">"REML"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sigma2 =</span>  <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>))</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(l3.removed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Multivariate Meta-Analysis Model (k = 33; method: REML)

  logLik  Deviance       AIC       BIC      AICc   
-29.1742   58.3483   62.3483   65.2798   62.7621   

Variance Components:

            estim    sqrt  nlvls  fixed        factor 
sigma^2.1  0.0000  0.0000     14    yes        author 
sigma^2.2  0.3550  0.5959     33     no  author/es.id 

Test for Heterogeneity:
Q(df = 32) = 4195.8268, p-val &lt; .0001

Model Results:

estimate      se    tval  df    pval   ci.lb   ci.ub      
  0.5985  0.1051  5.6938  32  &lt;.0001  0.3844  0.8126  *** 

---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Nu is de functie <code>anova</code> te gebruiken door twee modellen te vergelijken. Dit geeft een <span class="math inline">\(p\)</span>-waarde terug. Als nu de <span class="math inline">\(p\)</span>-waarde significant is, heeft het complexere model (drie niveaus) de voorkeur. Als de <span class="math inline">\(p\)</span>-waarde niet significant is, heeft het eenvoudigere model (twee niveaus) de voorkeur.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(l3.removed, full.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
        df     AIC     BIC    AICc   logLik     LRT   pval        QE 
Full     3 48.2458 52.6430 49.1029 -21.1229                4195.8268 
Reduced  2 62.3483 65.2798 62.7621 -29.1742 16.1025 &lt;.0001 4195.8268 </code></pre>
</div>
</div>
<p>We zien dat het <code>Full</code> (drie-niveaus) model inderdaad beter past dan het <code>Reduced</code> model met twee niveaus. De Akaike (AIC) en Bayesiaanse Informatie Criterium (BIC) zijn lager voor dit model, wat duidt op gunstige prestaties. De likelihood ratio test (<code>LRT</code>) die beide modellen vergelijkt is significant (<span class="math inline">\(\chi^2_1=\)</span> 16,1, <span class="math inline">\(p&lt;\)</span> 0,001), en wijst dus in dezelfde richting.</p>
<p>We kunnen zeggen dat, hoewel het model met drie niveaus één extra parameter introduceert (d.w.z. het heeft 3 vrijheidsgraden in plaats van 2), deze extra complexiteit gerechtvaardigd lijkt. Het modelleren van de geclusterde datastructuur was waarschijnlijk een goed idee en heeft onze schatting van het gepoolde effect verbeterd.</p>
<p>Houd er echter rekening mee dat er vaak goede redenen zijn om vast te houden aan een structuur met drie niveaus, zelfs als dit <strong>geen</strong> significant betere fit oplevert. Het is met name zinvol om vast te houden aan een model met drie niveaus als we denken dat het gebaseerd is op een solide theoretische onderbouwing.</p>
</section>
<section id="subgroup-analyse-moderatoren-analyse-in-dit-drie-niveaus-model" class="level3">
<h3 class="anchored" data-anchor-id="subgroup-analyse-moderatoren-analyse-in-dit-drie-niveaus-model">Subgroup analyse (moderatoren analyse) in dit drie niveau’s model</h3>
<p>Zodra ons model op drie niveaus is ingesteld, is het ook mogelijk om de invloed van mogelijke moderatoren op het totale effect te beoordelen. Eerder in deze gids hebben we ontdekt dat subgroepanalyses kunnen worden uitgedrukt als een meta-regressiemodel met een dummycode voorspeller. Op vergelijkbare wijze kunnen we regressietermen toevoegen aan een “multilevel” model, wat leidt tot een ** mixed-effects model met drie niveaus**:</p>
<p><span class="math display">\[\hat\theta_{ij} = \theta + \beta x_i + \zeta_{(2)ij} + \zeta_{(3)j} + \epsilon_{ij}\]</span></p>
<p>Waarbij <span class="math inline">\(\theta\)</span> het intercept is en <span class="math inline">\(\beta\)</span> het regressiegewicht van een voorspellende variabele <span class="math inline">\(x\)</span>. Als we <span class="math inline">\(x_i\)</span> vervangen door een dummy, krijgen we een model dat kan worden gebruikt voor subgroepanalyses. Als <span class="math inline">\(x\)</span> continu is, stelt de bovenstaande formule een meta-regressiemodel met drie niveaus voor.</p>
<p>Categorische of continue voorspellers kunnen gespecificeerd worden in <code>rma.mv</code> met het <code>mods</code> argument. Het argument vereist een formule, beginnend met een tilde (<code>~</code>), en dan de naam van de voorspeller. Meervoudige meta-regressie is ook mogelijk door meer dan één voorspeller op te geven (bijvoorbeeld <code>~ var1 + var2</code>).</p>
<p>In het <code>Chernobyl</code> voorbeeld willen we controleren of correlaties verschillen afhankelijk van de totale hoeveelheid straling in het onderzochte monster (laag, gemiddeld of hoog). De moderator is in dit geval <code>radiation</code>. Deze informatie staat in de kolom <code>radiation</code> in onze dataset. Met onderstaande code kunnen we een moderatorenmodel met drie niveaus fitten:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>mod.model <span class="ot">&lt;-</span> <span class="fu">rma.mv</span>(<span class="at">yi =</span> z, <span class="at">V =</span> var.z, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">slab =</span> author, <span class="at">data =</span> Chernobyl,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> author<span class="sc">/</span>es.id, </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">test =</span> <span class="st">"t"</span>, <span class="at">method =</span> <span class="st">"REML"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">mods =</span> <span class="sc">~</span> radiation)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>De eerste belangrijke uitkomst is de <code>Test van moderatoren</code>. We zien dat <span class="math inline">\(F_{2,28}\)</span>= 0,45, met <span class="math inline">\(p\)</span>= 0,64. Dit betekent dat er geen significant verschil is tussen de subgroepen. Dit is hoe we de resultaten multilevel meta-analyse met een mzouden beschrijven</p>
<blockquote class="blockquote">
<p>“De gepoolde correlatie op basis van het meta-analytische model met drie niveaus was <span class="math inline">\(r=\)</span> 0,48 (95%CI: 0,25-0,66; <span class="math inline">\(p\)</span> &lt; 0,001). De geschatte variantiecomponenten waren <span class="math inline">\(0,179\)</span> en <span class="math inline">\(0,119\)</span>. Dit betekent dat <span class="math inline">\(I^2_{Level 3}=\)</span> 0,179 en <span class="math inline">\(I^2_{Level 2}=\)</span> 0,119. Dit betekent dat <span class="math inline">\(I^2_{{Level 3}}=\)</span> 58,22% van de totale variatie kan worden toegeschreven aan tussen-cluster heterogeniteit en <span class="math inline">\(I^2_{{Level 2}}=\)</span> 31,86% aan binnen-cluster heterogeniteit. We vonden dat het model met drie niveaus een significant betere fit gaf vergeleken met een model met twee niveaus waarbij heterogeniteit op niveau 3 tot nul werd beperkt (<span class="math inline">\(I^2_1=\)</span> 16,10; <span class="math inline">\(p\)</span>&lt; 0,001).”</p>
</blockquote>
</section>
</section>
<section id="materialen" class="level2">
<h2 class="anchored" data-anchor-id="materialen">Materialen</h2>
<ul>
<li><a href="https://bookdown.org/MathiasHarrer/Doing_Meta_Analysis_in_R/">Hier</a> vind je het boek van Harrer en anderen.</li>
<li><a href="https://www.researchgate.net/publication/307168012_Fitting_three-level_meta-analytic_models_in_R_A_step-by-step_tutorial">Hier</a> vind je het artikel van Assink en Wibbelink.</li>
<li><a href="https://pure.uva.nl/ws/files/2679897/166572_Handleiding_drie_level_meta_analyse_in_R_versie_3.2_.pdf">Hier</a> vind je de handleiding bij dat artikel.</li>
<li><a href="https://pubmed.ncbi.nlm.nih.gov/25666381/">Hier</a> vind je de Chernobyl-studie van Møller en Mousseau.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>