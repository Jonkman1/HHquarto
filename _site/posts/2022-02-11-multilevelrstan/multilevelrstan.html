<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>Introductie op multilevel modelleren met gebruik van **rstanarm**: Een tutorial voor onderwijsonderzoekers</title>

  <meta property="description" itemprop="description" content="Een tutorial over multilevel Bayes"/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2022-02-06"/>
  <meta property="article:created" itemprop="dateCreated" content="2022-02-06"/>
  <meta name="article:author" content="JoonHo Lee, Nicholas Sim, Feng Ji, and Sophia Rabe-Hesketh, vertaling HarrieJonkman"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Introductie op multilevel modelleren met gebruik van **rstanarm**: Een tutorial voor onderwijsonderzoekers"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Een tutorial over multilevel Bayes"/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Introductie op multilevel modelleren met gebruik van **rstanarm**: Een tutorial voor onderwijsonderzoekers"/>
  <meta property="twitter:description" content="Een tutorial over multilevel Bayes"/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output"]}},"value":[{"type":"character","attributes":{},"value":["Introductie op multilevel modelleren met gebruik van **rstanarm**: Een tutorial voor onderwijsonderzoekers"]},{"type":"character","attributes":{},"value":["Een tutorial over multilevel Bayes\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["JoonHo Lee, Nicholas Sim, Feng Ji, and Sophia Rabe-Hesketh, vertaling HarrieJonkman"]}]}]},{"type":"character","attributes":{},"value":["2022-02-06"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained"]}},"value":[{"type":"logical","attributes":{},"value":[false]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["multilevelrstan_files/figure-html5/unnamed-chunk-13-1.png","multilevelrstan_files/figure-html5/unnamed-chunk-16-1.png","multilevelrstan_files/figure-html5/unnamed-chunk-25-1.png","multilevelrstan_files/figure-html5/unnamed-chunk-28-1.png","multilevelrstan_files/figure-html5/unnamed-chunk-37-1.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="multilevelrstan_files/header-attrs-2.11/header-attrs.js"></script>
  <script src="multilevelrstan_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="multilevelrstan_files/popper-2.6.0/popper.min.js"></script>
  <link href="multilevelrstan_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="multilevelrstan_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="multilevelrstan_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="multilevelrstan_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="multilevelrstan_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="multilevelrstan_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="multilevelrstan_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Introductie op multilevel modelleren met gebruik van **rstanarm**: Een tutorial voor onderwijsonderzoekers","description":"Een tutorial over multilevel Bayes","authors":[{"author":"JoonHo Lee, Nicholas Sim, Feng Ji, and Sophia Rabe-Hesketh, vertaling HarrieJonkman","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2022-02-06T00:00:00.000+01:00","citationText":"HarrieJonkman, 2022"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Introductie op multilevel modelleren met gebruik van rstanarm: Een tutorial voor onderwijsonderzoekers</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>Een tutorial over multilevel Bayes</p></p>
</div>

<div class="d-byline">
  JoonHo Lee, Nicholas Sim, Feng Ji, and Sophia Rabe-Hesketh, vertaling HarrieJonkman  
  
<br/>2022-02-06
</div>

<div class="d-article">
<div class="layout-chunk" data-layout="l-body">

</div>
<blockquote>
<p>Een paar jaar geleden schreven Joonho Lee en collega’s van de Berkley Universiteit onder leiding van Sophia Rabe-Hesketh (van wie ik al eerder veel geleerd heb over multilevel analyse) een mooie tutorial over het gebruik van <strong>rstanarm</strong> in multilevelanalyse. Omdat deze tutorial in vele opzichten leerzaam is, heb ik deze vertaald. Zo maakte ik mij het werken met rstanarm eigen maar ook hoe je zo’n tutorial in rmarkdown zet. Alle credits gaan natuurlijk naar Joonhoo Lee e.a.. De oorspronkelijke tutorial van 24 april 2018 vind je <a href="https://mc-stan.org/users/documentation/case-studies/tutorial_rstanarm.html">hier</a>. Later vond ik ook op github de syntax en kon ik diverse eigen fouten weer bijstellen <a href="https://github.com/stan-dev/example-models/blob/master/education/tutorial_rstanarm/tutorial_rstanarm.Rmd">hier</a>.</p>
</blockquote>
<h1 id="introductie">Introductie</h1>
<p>Een veel voorkomend kenmerk van datastructuren in het onderwijs is dat analyse-eenheden (b.v. leerlingen) genest zijn in hogere organisatorische clusters (b.v. scholen). Dit soort structuren leidt tot afhankelijkheid tussen de antwoorden die worden waargenomen voor eenheden binnen dezelfde cluster. Leerlingen in dezelfde school hebben in het algemeen de neiging meer gelijkenissen te vertonen in hun academische en attitudinale kenmerken dan leerlingen die willekeurig uit de bevolking worden gekozen.</p>
<p><em>Multilevel modellen</em>1 zijn ontworpen om dergelijke afhankelijkheid binnen clusters te modelleren. Multilevelmodellen erkennen het bestaan van gegevensclustering (op twee of meer niveaus) door residuele componenten op elk niveau in de hiërarchie toe te staan. Bijvoorbeeld, een model met twee niveaus dat de groepering van leerlingresultaten binnen scholen toelaat, zou residuen op zowel leerling- als schoolniveau omvatten. De residuele variantie wordt dan verdeeld in een tussen-school component (de variantie van de residuen op schoolniveau) en een binnen-school component (de variantie van de residuen op leerlingniveau).</p>
<p>In deze tutorial laten Joonhoo Lee en collega’s zien hoe je een multilevel lineair model kunt fitten binnen een volledig Bayesiaans raamwerk met <strong>rstanarm</strong>. Deze handleiding is in de eerste plaats gericht op onderwijsonderzoekers die <strong>lme4</strong> in <strong>R</strong> hebben gebruikt om modellen te fitten op hun gegevens en die mogelijk geïnteresseerd zijn in het leren fitten van Bayesiaanse multilevel modellen. Voor lezers die <strong>lme4</strong> nog niet eerder hebben gebruikt, geven we echter een kort overzicht van het gebruik van het pakket voor het fitten van multilevel modellen.</p>
<p>Deze tutorial maakt gebruik van <strong>Stan</strong> versie 2.17.3 en vereist de volgende <strong>R</strong> pakketten.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Pakketten die nodig zijn</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>mlmRev</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/lme4/lme4/'>lme4</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://mc-stan.org/rstanarm/'>rstanarm</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://ggplot2.tidyverse.org'>ggplot2</a></span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h2 id="data-voorbeeld">Data voorbeeld</h2>
<p>Ze analyseren de Gcsemv dataset (Rasbash et al. 2000) uit het <strong>mlmRev</strong> pakket in <strong>R</strong>. De gegevens omvatten de GCSE-examenscores (General Certificate of Secondary Education) van 1.905 leerlingen van 73 scholen in Engeland op een natuurwetenschappelijk vak. De Gcsemv-dataset bestaat uit de volgende 5 variabelen:</p>
<ul>
<li><em>school</em>: schoolidentificatiecode<br />
</li>
<li><em>student</em>: identificatiecode student<br />
</li>
<li><em>gender</em>: geslacht van een leerling (M: Man, F: Vrouw)<br />
</li>
<li><em>written</em>: totaalscore op schriftelijk werkstuk</li>
<li><em>course</em>: totaalscore op schriftelijk werkstuk</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Use example dataset from mlmRev package: GCSE exam score</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>Gcsemv</span>, package <span class='op'>=</span> <span class='st'>"mlmRev"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>Gcsemv</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>     school        student     gender      written     
 68137  : 104   77     :  14   F:1128   Min.   : 0.60  
 68411  :  84   83     :  14   M: 777   1st Qu.:37.00  
 68107  :  79   53     :  13            Median :46.00  
 68809  :  73   66     :  13            Mean   :46.37  
 22520  :  65   27     :  12            3rd Qu.:55.00  
 60457  :  54   110    :  12            Max.   :90.00  
 (Other):1446   (Other):1827            NA&#39;s   :202    
     course      
 Min.   :  9.25  
 1st Qu.: 62.90  
 Median : 75.90  
 Mean   : 73.39  
 3rd Qu.: 86.10  
 Max.   :100.00  
 NA&#39;s   :180     </code></pre>
</div>
<p>Twee onderdelen van het examen werden geregistreerd als uitkomstvariabelen: schriftelijk werkstuk (<strong>written</strong>) en cursuswerkstuk (<strong>course</strong>). In deze tutorial wordt alleen de totaalscore op het cursuswerkstuk (<em>course</em>) geanalyseerd. Zoals hierboven te zien is, ontbreken er bij sommige waarnemingen waarden voor bepaalde covariaten. Hoewel we de data niet subsetten om alleen volledige gevallen op te nemen om aan te tonen dat <strong>rstanarm</strong> deze waarnemingen automatisch laat vallen, is het over het algemeen een goed gebruik om dit handmatig te doen indien nodig.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Maak Male dereferentiecategorie en hernoem de variabele</span>
<span class='va'>Gcsemv</span><span class='op'>$</span><span class='va'>female</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/relevel.html'>relevel</a></span><span class='op'>(</span><span class='va'>Gcsemv</span><span class='op'>$</span><span class='va'>gender</span>, <span class='st'>"M"</span><span class='op'>)</span>


<span class='co'># Gebruik alleen de totaalscore op course </span>
<span class='va'>GCSE</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>Gcsemv</span>, 
               select <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>school</span>, <span class='va'>student</span>, <span class='va'>female</span>, <span class='va'>course</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># Tel unieke scholen en studenten</span>
<span class='va'>J</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>GCSE</span><span class='op'>$</span><span class='va'>school</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>N</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>GCSE</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Het pakket <strong>rstanarm</strong> automatiseert verschillende stappen van datavoorbewerking, waardoor het gebruik ervan sterk lijkt op dat van <strong>lme4</strong> en wel op de volgende manier.</p>
<ul>
<li><p><em>Input</em> - <strong>rstanarm</strong> kan een dataframe als input nemen2.</p></li>
<li><p><em>Ontbrekende gegevens</em> - <strong>rstanarm</strong> verwijdert automatisch waarnemingen met NA waarden voor elke variabele gebruikt in het model3.</p></li>
<li><p><em>Identifiers</em> - <strong>rstanarm</strong> vereist niet dat identifiers opeenvolgend zijn4. We stellen voor dat het een goede gewoonte is om alle cluster- en unit-identifiers, evenals categorische variabelen als factoren op te slaan. Dit geldt evenzeer voor <strong>lme4</strong> als voor <strong>rstanarm</strong>. Men kan de structuur van de variabelen controleren met behulp van de <code>str()</code> functie.</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Check structure of data frame</span>
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>GCSE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>&#39;data.frame&#39;:   1905 obs. of  4 variables:
 $ school : Factor w/ 73 levels &quot;20920&quot;,&quot;22520&quot;,..: 1 1 1 1 1 1 1 1 1 2 ...
 $ student: Factor w/ 649 levels &quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,..: 16 25 27 31 42 62 101 113 146 1 ...
 $ female : Factor w/ 2 levels &quot;M&quot;,&quot;F&quot;: 1 2 2 2 1 2 2 1 1 2 ...
 $ course : num  NA 71.2 76.8 87.9 44.4 NA 89.8 17.5 32.4 84.2 ...</code></pre>
</div>
<h1 id="likelihood-inferentie-met-lmer">Likelihood inferentie met <code>lmer()</code></h1>
<p>In dit deel bespreken we kort drie lineaire multilevelmodellen die in deze tutorial zullen worden toegepast. We beginnen met een variërend intercept model zonder voorspellers (Model 1), dan gaan we verder met het variërend intercept model met één voorspeller (Model 2), en het variërend intercept en helling model (Model 3).</p>
<h2 id="model-1-variërend-intercept-model-zonder-voorspellers-variantiecomponentenmodel">Model 1: Variërend intercept model zonder voorspellers (Variantiecomponentenmodel)</h2>
<p>Beschouw het eenvoudigste multilevel model voor leerlingen <span class="math inline">\(i=1,...,n\)</span> genest binnen scholen <span class="math inline">\(j=1,...,J\)</span> en voor wie we examenresultaten als respons hebben. We kunnen een variabel interceptmodel met twee niveaus zonder voorspellers schrijven met de gebruikelijke tweedelige formulering als</p>
<p><span class="math display">\[Y_{ij}=\alpha_{j} + \epsilon_{ij}, \text{ where } \epsilon{ij} \sim N(0,\sigma^2_{y}) \]</span> <span class="math display">\[\alpha{_j}=u_{\alpha} + u_{j}, \text { where } \epsilon{ij} \sim N(0,\sigma^2_{y})\]</span> waarin <span class="math inline">\(yij\)</span> de examenscore is voor de <span class="math inline">\(ith\)</span> leerling op de <span class="math inline">\(jth\)</span> school, <span class="math inline">\(\alpha_{j}\)</span> de variërende intercept voor de jde school, en <span class="math inline">\(u_{a}\)</span> het algemene gemiddelde voor alle scholen. Als alternatief kan het model in verkorte vorm worden uitgedrukt als</p>
<p><span class="math display">\[y_{ij}=u_{a} + u_{j} = \epsilon_{ij}\]</span> Als we verder aannemen dat de fouten op leerlingniveau <span class="math inline">\(\epsilon_{ij}\)</span> normaal verdeeld zijn met gemiddelde 0 en variantie <span class="math inline">\(\sigma^2_{y}\)</span>, en dat de variërende intercepten op schoolniveau <span class="math inline">\(\alpha_j\)</span> normaal verdeeld zijn met gemiddelde <span class="math inline">\(u_{a}\)</span> en variantie <span class="math inline">\(\sigma^2_{a}\)</span>, dan kan het model worden uitgedrukt als</p>
<p><span class="math display">\[y_{ij}∼ N(\alpha_{j},\sigma^2_{y})\]</span> <span class="math display">\[a_{j}∼ N(u_{a},\sigma^2_{a})\]</span></p>
<p>Dit model kan dan worden aangepast met <code>lmer()</code>. We specificeren een intercept (de voorspeller “1”) en laten deze variëren met de niveau-2-identifier (<em>school</em>). We specificeren ook de <code>REML = FALSE</code> optie om maximum likelihood (ML) schattingen te krijgen in plaats van de standaard restricted maximum likelihood (REML) schattingen.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>M1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/lme4/man/lmer.html'>lmer</a></span><span class='op'>(</span>formula <span class='op'>=</span> <span class='va'>course</span> <span class='op'>~</span> <span class='fl'>1</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>|</span> <span class='va'>school</span><span class='op'>)</span>, 
           data <span class='op'>=</span> <span class='va'>GCSE</span>, 
           REML <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>M1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Linear mixed model fit by maximum likelihood  [&#39;lmerMod&#39;]
Formula: course ~ 1 + (1 | school)
   Data: GCSE

     AIC      BIC   logLik deviance df.resid 
 14111.4  14127.7  -7052.7  14105.4     1722 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-4.9693 -0.5101  0.1116  0.6741  2.7613 

Random effects:
 Groups   Name        Variance Std.Dev.
 school   (Intercept)  75.24    8.674  
 Residual             190.77   13.812  
Number of obs: 1725, groups:  school, 73

Fixed effects:
            Estimate Std. Error t value
(Intercept)    73.72       1.11    66.4</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Onder <code>Fixed effects</code> zien we dat het intercept <span class="math inline">\(u_{a}\)</span>, gemiddeld over de populatie van scholen, wordt geschat op 73,72. Onder <code>Random-effects</code> zien we dat de standaardafwijking tussen de scholen <span class="math inline">\(\sigma_{a}\)</span> wordt geschat op <span class="math inline">\(8.67\)</span> en de standaardafwijking binnen de scholen <span class="math inline">\(\sigma_{y}\)</span> op <span class="math inline">\(13.81\)</span>.</p>
<h2 id="model-2-variërend-intercept-model-met-een-enkele-voorspeller">Model 2: Variërend intercept model met een enkele voorspeller</h2>
<p>Het variërende interceptmodel5 met een indicatorvariabele voor het vrouwzijn xij kan worden geschreven als</p>
<p><span class="math display">\[Y_{ij}∼N(a_{j}+\beta x{ij}, \sigma^2_{y}),\]</span><br />
<span class="math display">\[a_{j}∼N(u_{a}, \sigma^2_{a})\]</span>.</p>
<p>De vergelijking van de gemiddelde regressielijn voor alle scholen is <span class="math inline">\(u_{ij}=u_{α}+βxij\)</span>. De regressielijnen voor specifieke scholen zullen evenwijdig zijn aan de gemiddelde regressielijn (met dezelfde helling β), maar verschillen wat betreft het intercept <span class="math inline">\(a_{j}\)</span>. Dit model kan geschat worden door vrouwelijk toe te voegen aan de formule in de <code>lmer()</code> functie, waardoor alleen het intercept per school varieert en de “helling” voor vrouwelijkheid constant blijft voor alle scholen</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>M2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/lme4/man/lmer.html'>lmer</a></span><span class='op'>(</span>formula <span class='op'>=</span> <span class='va'>course</span> <span class='op'>~</span> <span class='fl'>1</span> <span class='op'>+</span> <span class='va'>female</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>|</span> <span class='va'>school</span><span class='op'>)</span>, 
           data <span class='op'>=</span> <span class='va'>GCSE</span>, 
           REML <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>M2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Linear mixed model fit by maximum likelihood  [&#39;lmerMod&#39;]
Formula: course ~ 1 + female + (1 | school)
   Data: GCSE

     AIC      BIC   logLik deviance df.resid 
 14017.4  14039.2  -7004.7  14009.4     1721 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-4.7809 -0.5401  0.1259  0.6795  2.6753 

Random effects:
 Groups   Name        Variance Std.Dev.
 school   (Intercept)  76.65    8.755  
 Residual             179.96   13.415  
Number of obs: 1725, groups:  school, 73

Fixed effects:
            Estimate Std. Error t value
(Intercept)   69.730      1.185   58.87
femaleF        6.739      0.678    9.94

Correlation of Fixed Effects:
        (Intr)
femaleF -0.338</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>De gemiddelde regressielijn over de scholen wordt dus geschat als <span class="math inline">\(\hat{\mu}_{ij}=69.73+ 6.74 x_{ij}\)</span>, waarbij <span class="math inline">\(\sigma_\_alpha\)</span> en <span class="math inline">\(\sigma_y\)</span> worden geschat als respectievelijk <span class="math inline">\(8.76\)</span> en <span class="math inline">\(13.41\)</span>. Als we deze schattingen van <span class="math inline">\(\mu_alpha\)</span>, <span class="math inline">\(\beta\)</span>, <span class="math inline">\(\sigma^2_{y}\)</span>, en <span class="math inline">\(\sigma^2_{alpha}\)</span> als de ware parameterwaarden beschouwen, kunnen we de **Best Linear Unbiased Predictions (BLUPs) voor de fouten op schoolniveau <span class="math inline">\(\hat{u}_j = \hat{\alpha}_{j} - \hat{\mu}_{\alpha}\)</span> verkrijgen.</p>
<p>De BLUPs zijn equivalent met de zogenaamde <strong>Empirical Bayes</strong> (EB)-voorspelling, die het gemiddelde is van de posterieure verdeling van <span class="math inline">\(u_{j}\)</span> gegeven alle geschatte parameters, alsmede de willekeurige variabelen <span class="math inline">\(y_{ij}\)</span> en <span class="math inline">\(x_{ij}\)</span> voor het cluster. Deze voorspellingen worden “Bayes” genoemd omdat ze gebruik maken van de vooraf gespecificeerde prioriteitsverdeling<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> <span class="math inline">\(u_j \sim N(\mu_\alpha, \sigma^2_\alpha)\)</span>, en bij uitbreiding <span class="math inline">\(u_j \sim N(0, \sigma^2_\alpha)\)</span>, en “Empirisch” genoemd omdat de parameters van deze prior, <span class="math inline">\(\mu_\alpha\)</span> en <span class="math inline">\(\sigma^2_{\alpha}\)</span>, naast <span class="math inline">\(\beta\)</span> en <span class="math inline">\(\sigma^2_{y}\)</span>, geschat worden uit de data.</p>
<p>In vergelijking met de ML-benadering (Maximum Likelihood - maximale waarschijnlijkheid), waarbij waarden voor <span class="math inline">\(u_j\)</span> worden voorspeld door alleen de geschatte parameters en gegevens van cluster <span class="math inline">\(j\)</span> te gebruiken, houdt de EB-benadering bovendien rekening met de voorafgaande verdeling van <span class="math inline">\(u_{j}\)</span>, en levert zij voorspelde waarden op die dichter bij <span class="math inline">\(0\)</span> liggen (een verschijnsel dat wordt beschreven als <em>shrinkage</em> of <em>partial pooling</em>). Om te zien waarom dit verschijnsel <em>shrinkage</em> wordt genoemd, drukken we de uit EB voorspelling verkregen schattingen voor <span class="math inline">\(u_j\)</span> gewoonlijk uit als <span class="math inline">\(\hat{u}_j^{text{EB}} = \hat{R}_j\hat{u}_j^{\text{ML}}\)</span> waarbij <span class="math inline">\(\hat{u}_j^{\text{ML}}\)</span> de ML schattingen zijn, en <span class="math inline">\(\hat{R}_j = \frac{\sigma_alpha^2}{n_j}\)</span> de zogenaamde Shrinkage factor is.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/lme4/man/ranef.html'>ranef</a></span><span class='op'>(</span><span class='va'>M2</span><span class='op'>)</span><span class='op'>$</span><span class='va'>school</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>      (Intercept)
20920 -10.1702110
22520 -17.0578149
22710   7.8007260
22738   0.4871012
22908  -8.1940346
23208   4.4304453</code></pre>
</div>
<p>Deze waarden schatten hoeveel het intercept naar boven of beneden verschoven is in bepaalde scholen. Bijvoorbeeld, in de eerste school in de dataset is het geschatte intercept ongeveer 10.17 lager dan gemiddeld, zodat de schoolspecifieke regressielijn <span class="math inline">\((69.73 - 10.17) + 6.74 x_{ij}\)</span> is.</p>
<p>Gelman&amp;Hill (2006) karakteriseren multilevel modellering als <em>partial pooling</em> (ook wel <em>shrinkage</em> genoemd), wat een compromis is tussen twee uitersten: <em>complete pooling</em>, waarbij de clustering helemaal niet in het model wordt meegenomen, en <em>no pooling</em>, waarbij voor elke school aparte intercepten worden geschat als coëfficiënten van dummy-variabelen. De geschatte schoolspecifieke regressielijnen in het bovenstaande model zijn gebaseerd op <em>partial pooling</em> schattingen. Om dit aan te tonen, schatten we eerst de intercept en de helling voor elke school op drie manieren:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Complete-pooling regression</span>
<span class='va'>pooled</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span>formula <span class='op'>=</span> <span class='va'>course</span> <span class='op'>~</span> <span class='va'>female</span>,
             data <span class='op'>=</span> <span class='va'>GCSE</span><span class='op'>)</span>
<span class='va'>a_pooled</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>pooled</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>   <span class='co'># complete-pooling intercept</span>
<span class='va'>b_pooled</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>pooled</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>   <span class='co'># complete-pooling slope</span>

<span class='co'># No-pooling regression</span>
<span class='va'>nopooled</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span>formula <span class='op'>=</span> <span class='va'>course</span> <span class='op'>~</span> <span class='fl'>0</span> <span class='op'>+</span> <span class='va'>school</span> <span class='op'>+</span> <span class='va'>female</span>,
               data <span class='op'>=</span> <span class='va'>GCSE</span><span class='op'>)</span>
<span class='va'>a_nopooled</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>nopooled</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='va'>J</span><span class='op'>]</span>   <span class='co'># 73 no-pooling intercepts              </span>
<span class='va'>b_nopooled</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>nopooled</span><span class='op'>)</span><span class='op'>[</span><span class='va'>J</span><span class='op'>+</span><span class='fl'>1</span><span class='op'>]</span>

<span class='co'># Partial pooling (multilevel) regression</span>
<span class='va'>a_part_pooled</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>M2</span><span class='op'>)</span><span class='op'>$</span><span class='va'>school</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span>
<span class='va'>b_part_pooled</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>M2</span><span class='op'>)</span><span class='op'>$</span><span class='va'>school</span><span class='op'>[</span>, <span class='fl'>2</span><span class='op'>]</span>
</code></pre>
</div>
</div>
<p>Vervolgens plotten we de gegevens en schoolspecifieke regressielijnen voor een selectie van acht scholen met behulp van de volgende commando’s.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># (0) Assen plaatsen &amp; scholen kiezen</span>
<span class='va'>y</span> <span class='op'>&lt;-</span> <span class='va'>GCSE</span><span class='op'>$</span><span class='va'>course</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>GCSE</span><span class='op'>$</span><span class='va'>female</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='va'>N</span>, <span class='op'>-</span><span class='fl'>.05</span>, <span class='fl'>.05</span><span class='op'>)</span>
<span class='va'>schid</span> <span class='op'>&lt;-</span> <span class='va'>GCSE</span><span class='op'>$</span><span class='va'>school</span>
<span class='va'>sel.sch</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"65385"</span>,
             <span class='st'>"68207"</span>,
             <span class='st'>"60729"</span>,
             <span class='st'>"67051"</span>,
             <span class='st'>"50631"</span>,
             <span class='st'>"60427"</span>,
             <span class='st'>"64321"</span>,
             <span class='st'>"68137"</span><span class='op'>)</span>

<span class='co'># (1) Subset 8 van de scholen; genereer data frame</span>
<span class='va'>df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>x</span>, <span class='va'>schid</span><span class='op'>)</span>
<span class='va'>df8</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/subset.html'>subset</a></span><span class='op'>(</span><span class='va'>df</span>, <span class='va'>schid</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='va'>sel.sch</span><span class='op'>)</span>

<span class='co'># (2) Aangeven van schattingen van volledige-pooling, geen-pooling, gedeeltelijke pooling </span>
<span class='va'>df8</span><span class='op'>$</span><span class='va'>a_pooled</span> <span class='op'>&lt;-</span> <span class='va'>a_pooled</span> 
<span class='va'>df8</span><span class='op'>$</span><span class='va'>b_pooled</span> <span class='op'>&lt;-</span> <span class='va'>b_pooled</span>
<span class='va'>df8</span><span class='op'>$</span><span class='va'>a_nopooled</span> <span class='op'>&lt;-</span> <span class='va'>a_nopooled</span><span class='op'>[</span><span class='va'>df8</span><span class='op'>$</span><span class='va'>schid</span><span class='op'>]</span>
<span class='va'>df8</span><span class='op'>$</span><span class='va'>b_nopooled</span> <span class='op'>&lt;-</span> <span class='va'>b_nopooled</span>
<span class='va'>df8</span><span class='op'>$</span><span class='va'>a_part_pooled</span> <span class='op'>&lt;-</span> <span class='va'>a_part_pooled</span><span class='op'>[</span><span class='va'>df8</span><span class='op'>$</span><span class='va'>schid</span><span class='op'>]</span>
<span class='va'>df8</span><span class='op'>$</span><span class='va'>b_part_pooled</span> <span class='op'>&lt;-</span> <span class='va'>b_part_pooled</span><span class='op'>[</span><span class='va'>df8</span><span class='op'>$</span><span class='va'>schid</span><span class='op'>]</span>

<span class='co'># (3) Plot van hoe regressie fit voor de 8 scholen</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>df8</span>, 
       <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>x</span>, y <span class='op'>=</span> <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span>facets <span class='op'>=</span> <span class='op'>~</span> <span class='va'>schid</span>, 
             ncol <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_jitter.html'>geom_jitter</a></span><span class='op'>(</span>position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_jitter.html'>position_jitter</a></span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>.05</span>, 
                                         height <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_abline</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>intercept <span class='op'>=</span> <span class='va'>a_pooled</span>, 
                  slope <span class='op'>=</span> <span class='va'>b_pooled</span><span class='op'>)</span>, 
              linetype <span class='op'>=</span> <span class='st'>"solid"</span>, 
              color <span class='op'>=</span> <span class='st'>"blue"</span>, 
              size <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_abline</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>intercept <span class='op'>=</span> <span class='va'>a_nopooled</span>, 
                  slope <span class='op'>=</span> <span class='va'>b_nopooled</span><span class='op'>)</span>, 
              linetype <span class='op'>=</span> <span class='st'>"longdash"</span>, 
              color <span class='op'>=</span> <span class='st'>"red"</span>, 
              size <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_abline</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>intercept <span class='op'>=</span> <span class='va'>a_part_pooled</span>, 
                  slope <span class='op'>=</span> <span class='va'>b_part_pooled</span><span class='op'>)</span>, 
              linetype <span class='op'>=</span> <span class='st'>"dotted"</span>, 
              color <span class='op'>=</span> <span class='st'>"purple"</span>, 
              size <span class='op'>=</span> <span class='fl'>0.7</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>, 
                     labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"male"</span>, <span class='st'>"female"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>title <span class='op'>=</span> <span class='st'>"Schatting van Volledige-pooling, Geen-pooling en Gedeeltelijke pooling"</span>,
       x <span class='op'>=</span> <span class='st'>""</span>, 
       y <span class='op'>=</span> <span class='st'>"Totale score op cursuswerk paper"</span><span class='op'>)</span><span class='op'>+</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span> base_family <span class='op'>=</span> <span class='st'>"serif"</span><span class='op'>)</span>
</code></pre>
</div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-13"></span>
<img src="multilevelrstan_files/figure-html5/unnamed-chunk-13-1.png" alt="De blauw-gestreepte, rood-gestreepte en paars-gestippelde lijnen geven respectievelijk de volledige pooling, no-pooling en gedeeltelijke pooling schattingen weer. We zien dat de geschatte schoolspecifieke regressielijn van de gedeeltelijke pooling-schattingen tussen de volledige pooling- en de geenpooling-regressielijn ligt. Er is meer pooling (paarse stippellijn dichter bij blauwe ononderbroken lijn) op scholen met een kleine steekproefomvang. " width="528" />
<p class="caption">
Figure 1: De blauw-gestreepte, rood-gestreepte en paars-gestippelde lijnen geven respectievelijk de volledige pooling, no-pooling en gedeeltelijke pooling schattingen weer. We zien dat de geschatte schoolspecifieke regressielijn van de gedeeltelijke pooling-schattingen tussen de volledige pooling- en de geenpooling-regressielijn ligt. Er is meer pooling (paarse stippellijn dichter bij blauwe ononderbroken lijn) op scholen met een kleine steekproefomvang.
</p>
</div>
</div>
<h2 id="model-3-variërend-intercept-en-slope-model-met-een-enkele-voorspeller">Model 3: Variërend intercept en slope model met een enkele voorspeller</h2>
<p>We breiden nu het variërende interceptmodel met één voorspeller uit om zowel het intercept als de helling willekeurig te laten variëren tussen scholen met behulp van het volgende model <span class="math display">\[y_{ij} = \alpha_j + \beta_j x_{ij} +\epsilon_{ij},\]</span> <span class="math display">\[\alpha_j = \mu_\alpha + u_j,\]</span> <span class="math display">\[\beta_j = \mu_\beta + v_j,\]</span> or in a reduced form as <span class="math display">\[y_{ij} = \mu_\alpha + \mu_\beta x_{ij} + u_j + v_j x_{ij} + \epsilon_{ij}\]</span> where <span class="math inline">\(\epsilon_{ij} \sim N(0, \sigma_{y}^{2})\)</span> and <span class="math inline">\(\left( \begin{matrix} u_j \\ v_j \end{matrix} \right) \sim N\left( \left( \begin{matrix} 0 \\ 0 \end{matrix} \right) ,\left( \begin{matrix} { \sigma }_{ \alpha }^{ 2 } &amp; \rho { \sigma }_{ \alpha }{ \sigma }_{ \beta } \\ \rho { \sigma }_{ \alpha }{ \sigma }_{ \beta } &amp; { \sigma }_{ \beta }^{ 2 } \end{matrix} \right) \right)\)</span>.]:</p>
<p><span class="math display">\[y_{ij}\sim N(\alpha_{j}+\beta_{j}x_{ij} , \sigma_y ^2 ),\]</span> <span class="math display">\[\left( \begin{matrix} \alpha _{ j } \\ \beta _{ j } \end{matrix} \right) \sim N\left( \left( \begin{matrix} { \mu  }_{ \alpha  } \\ { \mu  }_{ \beta  } \end{matrix} \right) , \left( \begin{matrix} { \sigma  }_{ \alpha  }^{ 2 } &amp; \rho { \sigma  }_{ \alpha  }{ \sigma  }_{ \beta  } \\ \rho { \sigma  }_{ \alpha  }{ \sigma  }_{ \beta  } &amp; { \sigma  }_{ \beta  }^{ 2 } \end{matrix} \right)  \right).\]</span></p>
<p>Merk op dat we nu variatie hebben in de <span class="math inline">\(\alpha_{j}\)</span>’s en de <span class="math inline">\(\beta_{j}\)</span>’s, en ook een correlatie parameter <span class="math inline">\(\rho\)</span> tussen <span class="math inline">\(\alpha_{j}\)</span> en <span class="math inline">\(\beta_{j}\)</span>. Dit model kan gefit worden met gebruik van <code>lmer()</code> en wel als volgt:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>M3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/lme4/man/lmer.html'>lmer</a></span><span class='op'>(</span>formula <span class='op'>=</span> <span class='va'>course</span> <span class='op'>~</span> <span class='fl'>1</span> <span class='op'>+</span> <span class='va'>female</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='va'>female</span> <span class='op'>|</span> <span class='va'>school</span><span class='op'>)</span>, 
           data <span class='op'>=</span> <span class='va'>GCSE</span>, 
           REML <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>M3</span><span class='op'>)</span> 
</code></pre>
</div>
<pre><code>Linear mixed model fit by maximum likelihood  [&#39;lmerMod&#39;]
Formula: course ~ 1 + female + (1 + female | school)
   Data: GCSE

     AIC      BIC   logLik deviance df.resid 
 13983.4  14016.2  -6985.7  13971.4     1719 

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-4.6886 -0.5222  0.1261  0.6529  2.6729 

Random effects:
 Groups   Name        Variance Std.Dev. Corr 
 school   (Intercept) 102.93   10.146        
          femaleF      47.94    6.924   -0.52
 Residual             169.79   13.030        
Number of obs: 1725, groups:  school, 73

Fixed effects:
            Estimate Std. Error t value
(Intercept)   69.425      1.352  51.338
femaleF        7.128      1.131   6.302

Correlation of Fixed Effects:
        (Intr)
femaleF -0.574</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>In dit model wordt de residuele standaardafwijking binnen de school geschat als <span class="math inline">\(\hat{\sigma}_{y}=\)</span> 13.03. De geschatte standaardafwijkingen van de schoolintercepten en de schoolhellingen zijn respectievelijk <span class="math inline">\(\hat{\sigma}_{\alpha}= 10.15\)</span> en <span class="math inline">\(\hat{\sigma}_{\beta}= 6.92\)</span>. De geschatte correlatie tussen variërende intercepts en hellingen is <span class="math inline">\(\hat{\rho} = -0.52\)</span>. We kunnen een soortgelijke code als die in paragraaf 2.2 gebruiken om de gegevens en de schoolspecifieke regressielijnen voor een selectie van acht scholen te plotten.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="multilevelrstan_files/figure-html5/unnamed-chunk-16-1.png" width="480" /></p>
</div>
<h1 id="bayesiaanse-inferentie-voor-model-1">Bayesiaanse inferentie voor Model 1</h1>
<p>We kunnen snel en eenvoudig veel multilevel modellen fitten met behulp van de <code>lmer()</code> functie in <strong>R</strong>. Zoals eerder vermeld, zijn functies zoals <code>lmer()</code> gebaseerd op een combinatie van maximale waarschijnlijkheid (ML) schatting van de model parameters en empirische Bayes (EB) voorspellingen van de variërende intercepts en/of hellingen. In sommige gevallen, wanneer het aantal groepen klein is of wanneer het model veel variërende coëfficiënten of niet-nested componenten bevat, kan de ML-benadering echter minder goed werken, ten dele omdat er misschien niet genoeg informatie is om de variantieparameters nauwkeurig te schatten. In dergelijke gevallen levert de Restricted Maximum Likelihood (REML) Estimation redelijker gevolgtrekkingen op.</p>
<p>Een volledig Bayesiaanse benadering levert ook in deze gevallen redelijke gevolgtrekkingen op, met als bijkomend voordeel dat bij de voorspelling van de variërende intercepten en hellingen rekening wordt gehouden met alle onzekerheid in de parameterschattingen en met de daarmee samenhangende onzekerheid. Dit is een van de vele redenen waarom men geïnteresseerd zou moeten zijn in volledig Bayesiaanse schattingen. Andere redenen worden besproken in paragraaf 3.4.3. Men kan beginnen met het snel fitten van vele specificaties bij het bouwen van een model met behulp van de <code>lmer()</code> functie, en dan gebruik maken van de flexibiliteit van een volledig Bayesiaanse benadering met <strong>rstanarm</strong> om simulaties te verkrijgen die de onzekerheid over coëfficiënten, voorspellingen en andere grootheden die van belang zijn samenvatten.</p>
<p>In dit gedeelte laten we zien hoe model 1 kan worden ingepast en geëvalueerd met behulp van het pakket <strong>rstanarm</strong>. Als alternatief, maar dat komt niet in deze tutorial aan de orde, kan men ook een handgeschreven programma maken in <strong>Stan</strong> en het uitvoeren met behulp van het <strong>rstan</strong> pakket.</p>
<h2 id="gebruik-van-het-rstanarm-pakket">Gebruik van het rstanarm pakket</h2>
<p>Veel relatief eenvoudige modellen kunnen worden aangepast met behulp van het <strong>rstanarm</strong> pakket zonder enige code te schrijven in de <strong>Stan</strong> taal. Het <strong>rstanarm</strong> pakket is een “wrapper” voor het <strong>rstan</strong> pakket waarmee de meest gebruikte regressiemodellen kunnen worden geschat met behulp van Markov Chain Monte Carlo (MCMC) en toch kunnen worden gespecificeerd met de gebruikelijke R modelleersyntaxis. Onderwijs onderzoekers kunnen Bayesiaanse schatting gebruiken voor multilevel modellen met slechts minimale veranderingen in hun bestaande code met <code>lmer()</code>.</p>
<p>Bijvoorbeeld, Model 1 met standaard prior verdelingen voor <span class="math inline">\(\mu_{\alpha}\)</span>, <span class="math inline">\(\sigma_{\alpha}\)</span>, en <span class="math inline">\(\sigma_{y}\)</span> kan worden gespecificeerd met het <strong>rstanarm</strong> pakket door <code>stan_</code> toe te voegen aan de <code>lmer</code> aanroep:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>M1_stanlmer</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://mc-stan.org/rstanarm/reference/stan_glmer.html'>stan_lmer</a></span><span class='op'>(</span>formula <span class='op'>=</span> <span class='va'>course</span> <span class='op'>~</span> <span class='fl'>1</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>|</span> <span class='va'>school</span><span class='op'>)</span>, 
                         data <span class='op'>=</span> <span class='va'>GCSE</span>,
                         seed <span class='op'>=</span> <span class='fl'>349</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Deze <code>stan_lmer()</code> functie is qua syntax gelijk aan <code>lmer()</code>, maar in plaats van een maximum likelihood schatting uit te voeren, wordt een Bayesiaanse schatting uitgevoerd via MCMC. Omdat elke stap in de MCMC schatting random trekkingen uit de parameter ruimte inhoudt, voegen we een seed optie toe om ervoor te zorgen dat <code>stan_lmer</code> elke keer dat de code wordt uitgevoerd, dezelfde resultaten geeft.</p>
<h2 id="prior-distributies">Prior distributies</h2>
<p>Model 1 is een variabel interceptiemodel met normaal verdeelde leerlingresiduen en intercepten op schoolniveau: <span class="math inline">\(y_{ij} \sim N(\alpha_{j}, \sigma_{y}^{2}),\)</span> en <span class="math inline">\(\alpha_{j},\sim N(\mu_{alpha}, \sigma_{alpha}^{2})\)</span>. De normale verdeling voor de <span class="math inline">\(\alpha{j}\)</span>’s kan worden beschouwd als een prioriteitsverdeling voor deze variërende intercepten. De parameters van deze prior verdeling, <span class="math inline">\(\mu_{\alpha}\)</span> en <span class="math inline">\(\sigma_{\alpha}\)</span>, worden geschat uit de gegevens bij gebruik van maximum likelihood schatting. Bij volledige Bayesiaanse inferentie hebben alle hyperparameters (<span class="math inline">\(\mu_{\alpha}\)</span> en <span class="math inline">\(\sigma_{\alpha}\)</span>), samen met de andere niet-gemodelleerde parameters (in dit geval, <span class="math inline">\(\sigma_{y}\)</span>) ook een priorverdeling nodig.</p>
<p>Hier gebruiken we de standaard prior verdelingen voor de hyperparameters in <code>stan_lmer</code> door geen prior opties op te geven in <code>stan_lmer()</code> functie. De standaard priors zijn bedoeld als zwak informatief in de zin dat ze gematigde regularisatie bieden [Regularisatie kan worden beschouwd als een techniek om ervoor te zorgen dat schattingen binnen een acceptabel bereik van waarden worden begrensd] en helpen bij het stabiliseren van de berekening. Opgemerkt moet worden dat de auteurs van <strong>rstanarm</strong> suggereren om niet te vertrouwen op <strong>rstanarm</strong> om de standaard prior voor een model te specificeren, maar eerder om de priors expliciet te specificeren, zelfs als ze inderdaad de huidige standaard zijn, aangezien updates van het pakket andere defaults mee kunnen krijgen.</p>
<p>Ten eerste wordt, alvorens rekening te houden met de schaal van de variabelen, <span class="math inline">\(\mu_{alpha}\)</span> een normale priorverdeling gegeven met gemiddelde 0 en standaardafwijking 10. Dat wil zeggen, <span class="math inline">\(mu_{alpha} \sim N(0, 10^2)\)</span>. De standaardafwijking van deze prioriteitsverdeling, 10, is vijf keer zo groot als de standaardafwijking van de respons indien deze gestandaardiseerd zou zijn. Dit zou een dichte benadering moeten zijn van een niet-informatieve prior over het door de waarschijnlijkheid ondersteunde bereik, die in gevolgtrekkingen zou moeten geven die vergelijkbaar zijn met die verkregen met maximale waarschijnlijkheidsmethoden indien even zwakke priors worden gebruikt voor de andere parameters.</p>
<p>Ten tweede wordt de (ongeschaalde) prior voor <span class="math inline">\(\sigma_{y}\)</span> ingesteld op een exponentiële verdeling met de ‘rate’-parameter op 1.</p>
<p>Ten derde, om een prior voor de varianties en covarianties van de variërende (of “willekeurige”) effecten te specificeren, zal <strong>rstanarm</strong> deze matrix ontbinden in een correlatiematrix van de variërende effecten en een functie van hun varianties. Omdat er in dit voorbeeld slechts één variërend effect is, reduceert de standaard (ongeschaalde) prior voor <span class="math inline">\(\sigma_{\alpha}\)</span> die <strong>rstanarm</strong> gebruikt tot een exponentiële verdeling met de rate parameter op 1.</p>
<p>Ook moet worden opgemerkt dat <strong>rstanarm</strong> de priors zal schalen tenzij de <code>autoscale = FALSE</code> optie wordt gebruikt. Na het fitten van een model met <code>stan_lmer</code>, kunnen we de gebruikte priors controleren door de <code>prior_summary()</code> functie op te roepen.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Een samenvatting krijgen van de priors die gebruikt worden </span>
<span class='fu'><a href='https://mc-stan.org/rstanarm/reference/prior_summary.stanreg.html'>prior_summary</a></span><span class='op'>(</span>object <span class='op'>=</span> <span class='va'>M1_stanlmer</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Priors for model &#39;M1_stanlmer&#39; 
------
Intercept (after predictors centered)
  Specified prior:
    ~ normal(location = 73, scale = 2.5)
  Adjusted prior:
    ~ normal(location = 73, scale = 41)

Auxiliary (sigma)
  Specified prior:
    ~ exponential(rate = 1)
  Adjusted prior:
    ~ exponential(rate = 0.061)

Covariance
 ~ decov(reg. = 1, conc. = 1, shape = 1, scale = 1)
------
See help(&#39;prior_summary.stanreg&#39;) for more details</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Hiermee krijgen we de SD van de uitkomst </span>
<span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>GCSE</span><span class='op'>$</span><span class='va'>course</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 16.32096</code></pre>
</div>
<p>Zoals hierboven te zien is, worden de schalen van de priors voor <span class="math inline">\(\mu_{\alpha}\)</span> en <span class="math inline">\(\sigma_y\)</span> op respectievelijk <span class="math inline">\(163,21\)</span> en <span class="math inline">\(16,32\)</span> gezet na herschaling. Aangezien de standaard prior voor het intercept normaal is met een schaalparameter van <span class="math inline">\(10\)</span>, is de herschaalde prior ook normaal maar met een schaalparameter van <span class="math inline">\(\text{scale} \times \text{SD}(y) = 10 \times 16.321= 163.21\)</span>. Aangezien de standaard prior voor <span class="math inline">\(\sigma_y\)</span> exponentieel is met een snelheidsparameter van <span class="math inline">\(1\)</span> (of gelijkwaardig, de schaalparameter <span class="math inline">\(\text{scale} = \frac{1}{text{rate} = 1\)</span>), is de herschaalde prior eveneens exponentieel met een schaalparameter van <span class="math inline">\(\text{scale} \maal \text{SD}(y) = 1 maal 16,321= 16,32\)</span>.</p>
<h2 id="directe-output-van-stan_lmer">Directe output van <code>stan_lmer</code></h2>
<h3 id="posterior-medianen-en-posterior-mediaan-absolute-deviaties">Posterior medianen en posterior mediaan absolute deviaties</h3>
<p>We kunnen een snelle samenvatting van de fit van Model 1 weergeven door de <code>print</code> methode op de volgende manier te gebruiken:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>M1_stanlmer</span>, digits <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>stan_lmer
 family:       gaussian [identity]
 formula:      course ~ 1 + (1 | school)
 observations: 1725
------
            Median MAD_SD
(Intercept) 73.68   1.14 

Auxiliary parameter(s):
      Median MAD_SD
sigma 13.82   0.24 

Error terms:
 Groups   Name        Std.Dev.
 school   (Intercept)  8.87   
 Residual             13.82   
Num. levels: school 73 

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Hier is de puntschatting van <span class="math inline">\(\mu_{\alpha}\)</span> uit <code>stan_lmer</code> <span class="math inline">\(73.75\)</span> en dit komt overeen met de mediaan van de posterior trekkingen. Dit is vergelijkbaar met de ML schatting uit <code>lmer</code>. De puntschatting voor <span class="math inline">\(`sigma_{_alpha}\)</span> van <code>stan_lmer</code> is <span class="math inline">\(8.87\)</span>, die groter is dan de ML schatting (<span class="math inline">\(8.67\)</span>). Dit verschil kan deels komen doordat de ML benadering in <code>lmer()</code> geen rekening houdt met de onzekerheid in <span class="math inline">\(\mu_{\alpha}\)</span> bij het schatten van <span class="math inline">\(\sigma_{\alpha}\)</span>. De REML benadering (<span class="math inline">\(8.75\)</span>) in <code>lmer()</code> houdt, zoals eerder vermeld, wel rekening met deze onzekerheid.</p>
<p>Bij gebruik van <code>stan_lmer</code> worden standaardfouten verkregen door de mediaan absolute afwijking (MAD) van elke trekking ten opzichte van de mediaan van die trekkingen te beschouwen. Het is bekend dat ML de neiging heeft om onzekerheden te onderschatten, omdat het gebaseerd is op puntschattingen van hyperparameters. Full Bayes daarentegen propageert de onzekerheid in de hyperparameters over alle niveaus van het model en levert adequatere onzekerheidsschattingen op. Zie ook Brown e.a. (2006) voor verdere discussie.</p>
<h3 id="posterior-gemiddelden-posterior-standaard-deviaties-95-credible-interval-en-monte-carlo-fouten">Posterior gemiddelden, posterior standaard deviaties, 95% credible interval en Monte Carlo fouten</h3>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>M1_stanlmer</span>, 
        pars <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"(Intercept)"</span>, <span class='st'>"sigma"</span>, <span class='st'>"Sigma[school:(Intercept),(Intercept)]"</span><span class='op'>)</span>,
        probs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.025</span>, <span class='fl'>0.975</span><span class='op'>)</span>,
        digits <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
Model Info:
 function:     stan_lmer
 family:       gaussian [identity]
 formula:      course ~ 1 + (1 | school)
 algorithm:    sampling
 sample:       4000 (posterior sample size)
 priors:       see help(&#39;prior_summary&#39;)
 observations: 1725
 groups:       school (73)

Estimates:
                                        mean   sd     2.5%   97.5%
(Intercept)                            73.67   1.12  71.49  75.92 
sigma                                  13.82   0.24  13.36  14.30 
Sigma[school:(Intercept),(Intercept)]  78.67  15.55  53.46 114.10 

MCMC diagnostics
                                      mcse Rhat n_eff
(Intercept)                           0.05 1.01  572 
sigma                                 0.00 1.00 4579 
Sigma[school:(Intercept),(Intercept)] 0.61 1.00  641 

For each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).</code></pre>
</div>
<p>Het is de moeite waard om op te merken dat bij gebruik van de <code>summary</code> methode, de schatting voor de standaardafwijking <span class="math inline">\(sigma_y\)</span> het gemiddelde is van de posterior trekkingen van de parameter. Dit in tegenstelling tot de mediaan van de posterior trekkingen die we krijgen bij gebruik van de <code>print</code> methode. Een voordeel van het gebruik van de mediaan is dat de schatting voor <span class="math inline">\(\sigma_y^2\)</span> gewoon het kwadraat is van de schatting voor <span class="math inline">\(\sigma_y\)</span> als het aantal steekproeven oneven is. Dit is niet het geval bij gebruik van het gemiddelde. In dit geval, en meer algemeen wanneer we andere functies van de parameters moeten evalueren, moeten we de posterior trekkingen rechtstreeks benaderen. Dit wordt beschreven in het volgende deel.</p>
<p>Onder <code>Diagnostics</code>, verwijzen we de lezer naar Paragraaf 5 voor meer informatie over <code>Rhat</code> en <code>n_eff</code>. De waarden onder <code>mcse</code> vertegenwoordigen schattingen voor de Monte Carlo standaardfouten, die de willekeurigheid vertegenwoordigen die geassocieerd is met elke MCMC schattingsrun. Dat wil zeggen, met dezelfde dataset, herhaaldelijk gebruik van een MCMC benadering om een parameter te schatten levert schattingen op met een standaardafwijking gelijk aan de Monte Carlo standaardfout.</p>
<h2 id="andere-output-van-stan_lmer">Andere output van <code>stan_lmer</code></h2>
<p>Zoals gezegd, kunnen gebruikers er de voorkeur aan geven om direct met de posterior trekkingen te werken om schattingen van meer complexe parameters te verkrijgen. Om dit te doen, moeten gebruikers ze handmatig benaderen vanuit het <code>stan_lmer</code> object. We laten zien hoe dit moet in de context van het maken van vergelijkingen tussen individuele scholen.</p>
<h3 id="toegang-tot-de-simulaties-en-samenvattende-resultaten">Toegang tot de simulaties en samenvattende resultaten</h3>
<p>Gebaseerd op de standaard instellingen, genereert <code>stan_lmer</code> 4 MCMC-ketens van 2.000 iteraties elk. De helft van deze iteraties in elke keten wordt gebruikt als warming-up/burn-in (om de keten te laten convergeren naar de posterior verdeling), en daarom gebruiken we slechts 1.000 steekproeven per keten. Deze door MCMC gegenereerde steekproeven worden geacht getrokken te zijn uit de posterior verdelingen van de parameters in het model. Wij kunnen deze steekproeven gebruiken voor voorspellingen, om de onzekerheid samen te vatten en ‘çredible intervals’ (geloofwaardige intervallen) te schatten voor elke functie van de parameters.</p>
<p>Om toegang te krijgen tot de posterior trekkingen voor alle parameters, passen we de methode <code>as.matrix()</code> toe op het <code>stanreg</code> object <code>M1_stanlmer</code>. Dit geeft een <span class="math inline">\(S\)</span> bij <span class="math inline">\(P\)</span> matrix, waarbij <span class="math inline">\(S\)</span> de grootte is van de posterior steekproef (of gelijkwaardig, het aantal MCMC iteraties na warm-up) en <span class="math inline">\(P\)</span> het aantal parameters/kwantiteiten. Door deze matrix te manipuleren kunnen we een matrix genereren voor de variërende intercepts <span class="math inline">\(\alpha_{j}\)</span> en vectoren met de trekkingen voor de within standaardafwijking en de between variantie. Merk op dat om de juiste kolommen voor de parameter van belang te selecteren, het nuttig is om de kolomnamen van de matrix <code>sims</code> te onderzoeken.</p>
<p>Een meer directe benadering voor het verkrijgen van de posterior trekkingen voor specifieke parameters is gebruik te maken van de ingebouwde functionaliteit van de <code>as.matrix</code> methode voor <code>stanreg</code> objecten. Wanneer de <code>as.matrix</code> methode wordt toegepast op een <code>stanreg</code> object, kan de gebruiker ofwel een optionele karaktervector van parameternamen specificeren, of een optionele karaktervector van reguliere expressies<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> om de posterior trekkingen van alleen de parameters waarin ze geïnteresseerd zijn te extraheren. Bijvoorbeeld, omdat de parameter die het totale gemiddelde representeert is gelabeld met <code>(Intercept)</code>, kunnen we de posterior trekkingen van alleen deze parameter extraheren door de optie <code>pars = "(Intercept)"</code> op te nemen. En omdat de parameters die de 73 schoolfouten representeren allemaal de string <code>b[(Intercept) school:</code> bevatten, kunnen we alle parameters die deze string bevatten extraheren door de optie <code>regex_pars = "b[(Intercept) school:</code>” te gebruiken.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Extraheren van de posterior trekkingen voor alle parameters</span>
<span class='va'>sims</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>M1_stanlmer</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>sims</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>[1] 4000   76</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>para_name</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>sims</span><span class='op'>)</span>
<span class='va'>para_name</span>
</code></pre>
</div>
<pre><code> [1] &quot;(Intercept)&quot;                          
 [2] &quot;b[(Intercept) school:20920]&quot;          
 [3] &quot;b[(Intercept) school:22520]&quot;          
 [4] &quot;b[(Intercept) school:22710]&quot;          
 [5] &quot;b[(Intercept) school:22738]&quot;          
 [6] &quot;b[(Intercept) school:22908]&quot;          
 [7] &quot;b[(Intercept) school:23208]&quot;          
 [8] &quot;b[(Intercept) school:25241]&quot;          
 [9] &quot;b[(Intercept) school:30474]&quot;          
[10] &quot;b[(Intercept) school:35270]&quot;          
[11] &quot;b[(Intercept) school:37224]&quot;          
[12] &quot;b[(Intercept) school:47627]&quot;          
[13] &quot;b[(Intercept) school:50627]&quot;          
[14] &quot;b[(Intercept) school:50631]&quot;          
[15] &quot;b[(Intercept) school:60421]&quot;          
[16] &quot;b[(Intercept) school:60427]&quot;          
[17] &quot;b[(Intercept) school:60437]&quot;          
[18] &quot;b[(Intercept) school:60439]&quot;          
[19] &quot;b[(Intercept) school:60441]&quot;          
[20] &quot;b[(Intercept) school:60455]&quot;          
[21] &quot;b[(Intercept) school:60457]&quot;          
[22] &quot;b[(Intercept) school:60501]&quot;          
[23] &quot;b[(Intercept) school:60729]&quot;          
[24] &quot;b[(Intercept) school:60741]&quot;          
[25] &quot;b[(Intercept) school:63619]&quot;          
[26] &quot;b[(Intercept) school:63833]&quot;          
[27] &quot;b[(Intercept) school:64251]&quot;          
[28] &quot;b[(Intercept) school:64321]&quot;          
[29] &quot;b[(Intercept) school:64327]&quot;          
[30] &quot;b[(Intercept) school:64343]&quot;          
[31] &quot;b[(Intercept) school:64359]&quot;          
[32] &quot;b[(Intercept) school:64428]&quot;          
[33] &quot;b[(Intercept) school:65385]&quot;          
[34] &quot;b[(Intercept) school:66365]&quot;          
[35] &quot;b[(Intercept) school:67051]&quot;          
[36] &quot;b[(Intercept) school:67105]&quot;          
[37] &quot;b[(Intercept) school:67311]&quot;          
[38] &quot;b[(Intercept) school:68107]&quot;          
[39] &quot;b[(Intercept) school:68111]&quot;          
[40] &quot;b[(Intercept) school:68121]&quot;          
[41] &quot;b[(Intercept) school:68125]&quot;          
[42] &quot;b[(Intercept) school:68133]&quot;          
[43] &quot;b[(Intercept) school:68137]&quot;          
[44] &quot;b[(Intercept) school:68201]&quot;          
[45] &quot;b[(Intercept) school:68207]&quot;          
[46] &quot;b[(Intercept) school:68217]&quot;          
[47] &quot;b[(Intercept) school:68227]&quot;          
[48] &quot;b[(Intercept) school:68233]&quot;          
[49] &quot;b[(Intercept) school:68237]&quot;          
[50] &quot;b[(Intercept) school:68241]&quot;          
[51] &quot;b[(Intercept) school:68255]&quot;          
[52] &quot;b[(Intercept) school:68271]&quot;          
[53] &quot;b[(Intercept) school:68303]&quot;          
[54] &quot;b[(Intercept) school:68321]&quot;          
[55] &quot;b[(Intercept) school:68329]&quot;          
[56] &quot;b[(Intercept) school:68405]&quot;          
[57] &quot;b[(Intercept) school:68411]&quot;          
[58] &quot;b[(Intercept) school:68417]&quot;          
[59] &quot;b[(Intercept) school:68531]&quot;          
[60] &quot;b[(Intercept) school:68611]&quot;          
[61] &quot;b[(Intercept) school:68629]&quot;          
[62] &quot;b[(Intercept) school:68711]&quot;          
[63] &quot;b[(Intercept) school:68723]&quot;          
[64] &quot;b[(Intercept) school:68805]&quot;          
[65] &quot;b[(Intercept) school:68809]&quot;          
[66] &quot;b[(Intercept) school:71927]&quot;          
[67] &quot;b[(Intercept) school:74330]&quot;          
[68] &quot;b[(Intercept) school:74862]&quot;          
[69] &quot;b[(Intercept) school:74874]&quot;          
[70] &quot;b[(Intercept) school:76531]&quot;          
[71] &quot;b[(Intercept) school:76631]&quot;          
[72] &quot;b[(Intercept) school:77207]&quot;          
[73] &quot;b[(Intercept) school:84707]&quot;          
[74] &quot;b[(Intercept) school:84772]&quot;          
[75] &quot;sigma&quot;                                
[76] &quot;Sigma[school:(Intercept),(Intercept)]&quot;</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Verkrijgen van school-niveau varyiërende intercept a_j</span>
<span class='co'># trekking voor het algemeen gemiddelde</span>
<span class='va'>mu_a_sims</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>M1_stanlmer</span>, 
                       pars <span class='op'>=</span> <span class='st'>"(Intercept)"</span><span class='op'>)</span>
<span class='co'># trekkingen voor 73 scholen van de school-niveua fouten </span>
<span class='va'>u_sims</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>M1_stanlmer</span>, 
                    regex_pars <span class='op'>=</span> <span class='st'>"b\\[\\(Intercept\\) school\\:"</span><span class='op'>)</span>
<span class='co'># trekkingen van alle 73 school variërende intercepten               </span>
<span class='va'>a_sims</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>mu_a_sims</span><span class='op'>)</span> <span class='op'>+</span> <span class='va'>u_sims</span>          

<span class='co'># Verkrijgen van sigma_y en sigma_alpha^2</span>
<span class='co'># trekkingen van sigma_y</span>
<span class='va'>s_y_sims</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>M1_stanlmer</span>, 
                       pars <span class='op'>=</span> <span class='st'>"sigma"</span><span class='op'>)</span>
<span class='co'># trekkingen van sigma_alpha^2</span>
<span class='va'>s__alpha_sims</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='va'>M1_stanlmer</span>, 
                       pars <span class='op'>=</span> <span class='st'>"Sigma[school:(Intercept),(Intercept)]"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="verkrijgen-van-gemiddelden-standaard-deviaties-medianen-en-95-geloofwaardigheids-intervallen">Verkrijgen van gemiddelden, standaard deviaties, medianen en 95% geloofwaardigheids intervallen</h3>
<p>In <code>a_sims</code> hebben we 4.000 posterior trekkingen (van alle 4 ketens) voor de variërende intercepten <span class="math inline">\(\alpha_{j}\)</span> van de 73 scholen opgeslagen. De eerste kolom van de matrix van 4.000 bij 73 is bijvoorbeeld een vector van 4.000 posterior simulatietrekkingen voor de variërende intercept van de eerste school (School 20920). Een kwantitatieve manier om de posterior kansverdeling van deze 4.000 schattingen voor <span class="math inline">\(1,1pha_{1}\)</span> samen te vatten is het onderzoeken van hun quantielen.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Computeer gemiddelde, SD, mediaan en 95% geloofwaardigheids interval van de varyiërende intercepten</span>

<span class='co'># Posterior gemiddelde en SD van elke alpha</span>
<span class='va'>a_mean</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='va'>a_sims</span>,     <span class='co'># posterior gemiddelde</span>
                MARGIN <span class='op'>=</span> <span class='fl'>2</span>,
                FUN <span class='op'>=</span> <span class='va'>mean</span><span class='op'>)</span>
<span class='va'>a_sd</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='va'>a_sims</span>,       <span class='co'># posterior SD</span>
              MARGIN <span class='op'>=</span> <span class='fl'>2</span>,
              FUN <span class='op'>=</span> <span class='va'>sd</span><span class='op'>)</span>

<span class='co'># Posterior mediaan en 95% geloofwaardigheids interval</span>
<span class='va'>a_quant</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='va'>a_sims</span>, 
                 MARGIN <span class='op'>=</span> <span class='fl'>2</span>, 
                 FUN <span class='op'>=</span> <span class='va'>quantile</span>, 
                 probs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.025</span>, <span class='fl'>0.50</span>, <span class='fl'>0.975</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>a_quant</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>a_quant</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>a_quant</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Q2.5"</span>, <span class='st'>"Q50"</span>, <span class='st'>"Q97.5"</span><span class='op'>)</span>

<span class='co'># Combineer samenvattende statistieken van posterior simulatie trekkingen</span>
<span class='va'>a_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>a_mean</span>, <span class='va'>a_sd</span>, <span class='va'>a_quant</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>a_df</span><span class='op'>)</span>, <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>                            a_mean a_sd  Q2.5   Q50 Q97.5
b[(Intercept) school:20920]  63.63 4.40 54.97 63.57 72.17
b[(Intercept) school:22520]  57.15 1.79 53.72 57.15 60.60
b[(Intercept) school:22710]  81.64 3.15 75.47 81.64 87.78
b[(Intercept) school:22738]  73.03 4.27 64.48 73.11 81.50
b[(Intercept) school:22908]  66.51 5.28 56.47 66.47 76.70
b[(Intercept) school:23208]  79.23 2.81 73.60 79.22 85.02</code></pre>
</div>
<p>Wij kunnen een rupsplot maken om de volledige Bayes-schattingen voor de schoolafhankelijke intercepts in rangorde te tonen, samen met hun 95% credible intervallen.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Sorteer dataframe die een geschatte alfa gemiddelde en sd voor elke school omvatten</span>
<span class='va'>a_df</span> <span class='op'>&lt;-</span> <span class='va'>a_df</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span><span class='va'>a_df</span><span class='op'>$</span><span class='va'>a_mean</span><span class='op'>)</span>, <span class='op'>]</span>
<span class='va'>a_df</span><span class='op'>$</span><span class='va'>a_rank</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>:</span> <span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>a_df</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span>  <span class='co'># een vector van de schoolranking </span>

<span class='co'># Plot school-niveau alfas posterior gemiddelde en 95% credible interval</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>a_df</span>, 
       <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>a_rank</span>, 
           y <span class='op'>=</span> <span class='va'>a_mean</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_linerange.html'>geom_pointrange</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>ymin <span class='op'>=</span> <span class='va'>Q2.5</span>, 
                      ymax <span class='op'>=</span> <span class='va'>Q97.5</span><span class='op'>)</span>,
                  position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_jitter.html'>position_jitter</a></span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>0.1</span>, 
                                             height <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_hline</a></span><span class='op'>(</span>yintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>a_df</span><span class='op'>$</span><span class='va'>a_mean</span><span class='op'>)</span>, 
             size <span class='op'>=</span> <span class='fl'>0.5</span>, 
             col <span class='op'>=</span> <span class='st'>"red"</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span><span class='st'>"Rank"</span>, 
                     breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>0</span>, 
                                  to <span class='op'>=</span> <span class='fl'>80</span>, 
                                  by <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/expression.html'>expression</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"varying intercept, "</span>, <span class='va'>alpha</span><span class='op'>[</span><span class='va'>j</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span> base_family <span class='op'>=</span> <span class='st'>"serif"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="multilevelrstan_files/figure-html5/unnamed-chunk-25-1.png" width="528" /></p>
</div>
<p>Dezelfde aanpak kan natuurlijk worden gevolgd om 95% geloofwaardige intervallen te genereren voor <span class="math inline">\(\sigma_y\)</span> en <span class="math inline">\(\sigma_\alpha\)</span>.</p>
<h3 id="vergelijkingen-maken-tussen-individuele-scholen">Vergelijkingen maken tussen individuele scholen</h3>
<p>Het hebben van steekproeven van alle parameters en variërende intercepten uit hun gezamenlijke posterior verdeling maakt het gemakkelijk om inferenties te trekken over functies van deze parameters.</p>
<p>In onderwijsonderzoek en in de onderwijspraktijk is het vaak interessant om de scholen in de data met elkaar te vergelijken. Relevante vragen zijn bijvoorbeeld (1) wat is het verschil tussen de gemiddelden van school A en school B, (2) presteert school A beter dan school B en (3) wat is de rangorde van deze scholen binnen de steekproef. Wanneer niet-Bayesiaanse methoden worden gebruikt, kunnen wij proberen dergelijke vergelijkingen te maken op basis van empirische Bayes- (of Best Linear Unbiased-) voorspellingen van de variërende intercepten. Maar het zal in het algemeen onmogelijk zijn om de onzekerheid uit te drukken voor niet-lineaire functies zoals rangschikkingen. Zie ook Goldstein en Spiegelhalter (2006) voor verdere discussie.</p>
<p>Hier zullen we twee scholen vergelijken als voorbeeld: Scholen 60501 (de 21<sup>ste</sup> school) en 68271 (de 51<sup>ste</sup> school). We hebben al 4.000 posterior simulatietrekkingen voor beide scholen. Om conclusies te trekken over het verschil tussen de gemiddelde scores van de twee scholen, kunnen we eenvoudigweg het verschil nemen tussen de twee vectoren van trekkingen <span class="math inline">\(\alpha_{51} - \alpha_{21}\)</span>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Het verschil tussen de twee schoolgemiddelden (school #21 en #51)</span>
<span class='va'>school_diff</span> <span class='op'>&lt;-</span> <span class='va'>a_sims</span><span class='op'>[</span>, <span class='fl'>21</span><span class='op'>]</span> <span class='op'>-</span> <span class='va'>a_sims</span><span class='op'>[</span>, <span class='fl'>51</span><span class='op'>]</span>
</code></pre>
</div>
</div>
<p>Wij kunnen de posterior verdeling van het verschil als volgt onderzoeken met beschrijvende statistieken en een histogram:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Onderzoek verschillen van twee distributies </span>
<span class='va'>mean</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>school_diff</span><span class='op'>)</span>
<span class='va'>sd</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>school_diff</span><span class='op'>)</span>
<span class='va'>quantile</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span><span class='op'>(</span><span class='va'>school_diff</span>, probs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.025</span>, <span class='fl'>0.50</span>, <span class='fl'>0.975</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>quantile</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>quantile</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>quantile</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Q2.5"</span>, <span class='st'>"Q50"</span>, <span class='st'>"Q97.5"</span><span class='op'>)</span>
<span class='va'>diff_df</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>mean</span>, <span class='va'>sd</span>, <span class='va'>quantile</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>diff_df</span>, <span class='fl'>2</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>  mean   sd  Q2.5  Q50 Q97.5
1 5.12 4.48 -3.53 5.12 14.02</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Histogram van de verschillen </span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>school_diff</span><span class='op'>)</span>, 
       <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>school_diff</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_histogram.html'>geom_histogram</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"black"</span>, 
                 fill <span class='op'>=</span> <span class='st'>"gray"</span>, 
                 binwidth <span class='op'>=</span> <span class='fl'>0.75</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span><span class='st'>"Score verschil tussen twee scholen: #21, #51"</span>,
                     breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='op'>-</span><span class='fl'>20</span>, 
                                  to <span class='op'>=</span> <span class='fl'>20</span>, 
                                  by <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>school_diff</span><span class='op'>)</span>,
                            <span class='fu'><a href='https://rdrr.io/r/stats/quantile.html'>quantile</a></span><span class='op'>(</span><span class='va'>school_diff</span>, 
                                     probs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.025</span>, <span class='fl'>0.975</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,
             colour <span class='op'>=</span> <span class='st'>"red"</span>, 
             linetype <span class='op'>=</span> <span class='st'>"longdash"</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='fl'>5.11</span>, <span class='fl'>20</span>, label <span class='op'>=</span> <span class='st'>"mean = 5.11"</span><span class='op'>)</span>, 
            color <span class='op'>=</span> <span class='st'>"red"</span>, 
            size <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span><span class='fl'>9</span>, <span class='fl'>50</span>, label <span class='op'>=</span> <span class='st'>"SD = 4.46"</span><span class='op'>)</span>, 
            color <span class='op'>=</span> <span class='st'>"blue"</span>, 
            size <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span> base_family <span class='op'>=</span> <span class='st'>"serif"</span><span class='op'>)</span> 
</code></pre>
</div>
<p><img src="multilevelrstan_files/figure-html5/unnamed-chunk-28-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/proportions.html'>prop.table</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>a_sims</span><span class='op'>[</span>, <span class='fl'>21</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='va'>a_sims</span><span class='op'>[</span>, <span class='fl'>51</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
  FALSE    TRUE 
0.12425 0.87575 </code></pre>
</div>
<p>Het verwachte verschil komt uit op 5,11 met een standaardafwijking van 4,46 en een grote bandbreedte van onzekerheid. Het 95% geloofwaardigheidsinterval is [-3.64, 13.66], dus we zijn er 95% zeker van dat de ware waarde van het verschil tussen de twee scholen binnen het bereik ligt, gegeven de gegevens.</p>
<p>We kunnen ook het deel van de tijd bepalen dat School 60501 een hoger gemiddelde heeft dan School 68271:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/proportions.html'>prop.table</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>a_sims</span><span class='op'>[</span>, <span class='fl'>21</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='va'>a_sims</span><span class='op'>[</span>, <span class='fl'>51</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>
  FALSE    TRUE 
0.12425 0.87575 </code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Dit betekent dat de posterior waarschijnlijkheid dat School 60501 beter is dan School 68271 87.6% is. Elk paar scholen binnen de steekproef van scholen kan op deze manier vergeleken worden.</p>
<h1 id="bayesiaanse-inferentie-voor-model-2-en-3">Bayesiaanse inferentie voor Model 2 en 3</h1>
<h2 id="model-2-een-voorspeller-op-studentenniveau-toevoegen">Model 2: Een voorspeller op studentenniveau toevoegen</h2>
<p>Onderzoekers zouden de variërende interceptmodellen kunnen uitbreiden met waargenomen verklarende variabelen op het niveau van de leerling <span class="math inline">\(x_{ij}\)</span>, in dit voorbeeld een indicatorvariabele voor vrouw. Een eenvoudig variërend interceptmodel met één voorspeller op het niveau van de leerling kan worden geschreven als <span class="math inline">\(y_{ij} \N(\alpha_{j} + \beta x_{ij}, \sigma_{y}^{2})\)</span> en <span class="math inline">\(\alpha_{j} \N(\mu_{alpha}, \sigma_{alpha}^{2})\)</span>. We gebruiken niet-informatieve prioriteitsverdelingen voor de hyperparameters (<span class="math inline">\(\mu_{\alpha}\)</span> en <span class="math inline">\(\sigma_{\alpha}\)</span>) zoals gespecificeerd in het variërende interceptmodel zonder voorspellers. Bovendien krijgt de regressiecoëfficiënt <span class="math inline">\(\beta\)</span> een normale prioriteitsverdeling met gemiddelde 0 en standaardafwijking 100. Dit betekent, ruwweg, dat we verwachten dat deze coëfficiënt in het bereik <span class="math inline">\((-100, 100)\)</span> ligt, en als de ML schatting in dit bereik ligt, geeft de prior verdeling zeer weinig informatie voor de inferentie.</p>
<p>Het bovenstaande model kan als volgt worden gefit met de <code>stan_lmer()</code> functie in het <strong>rstanarm</strong> pakket:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>M2_stanlmer</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://mc-stan.org/rstanarm/reference/stan_glmer.html'>stan_lmer</a></span><span class='op'>(</span>formula <span class='op'>=</span> <span class='va'>course</span> <span class='op'>~</span> <span class='va'>female</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>|</span> <span class='va'>school</span><span class='op'>)</span>, 
                         data <span class='op'>=</span> <span class='va'>GCSE</span>, 
                         prior <span class='op'>=</span> <span class='fu'><a href='https://mc-stan.org/rstanarm/reference/priors.html'>normal</a></span><span class='op'>(</span>location <span class='op'>=</span> <span class='fl'>0</span>, 
                                        scale <span class='op'>=</span> <span class='fl'>100</span>,
                                        autoscale <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>,
                         prior_intercept <span class='op'>=</span> <span class='fu'><a href='https://mc-stan.org/rstanarm/reference/priors.html'>normal</a></span><span class='op'>(</span>location <span class='op'>=</span> <span class='fl'>0</span>, 
                                                  scale <span class='op'>=</span> <span class='fl'>100</span>, 
                                                  autoscale <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>,
                         seed <span class='op'>=</span> <span class='fl'>349</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://mc-stan.org/rstanarm/reference/prior_summary.stanreg.html'>prior_summary</a></span><span class='op'>(</span>object <span class='op'>=</span> <span class='va'>M2_stanlmer</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Priors for model &#39;M2_stanlmer&#39; 
------
Intercept (after predictors centered)
 ~ normal(location = 0, scale = 100)

Coefficients
 ~ normal(location = 0, scale = 100)

Auxiliary (sigma)
  Specified prior:
    ~ exponential(rate = 1)
  Adjusted prior:
    ~ exponential(rate = 0.061)

Covariance
 ~ decov(reg. = 1, conc. = 1, shape = 1, scale = 1)
------
See help(&#39;prior_summary.stanreg&#39;) for more details</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>M2_stanlmer</span>
</code></pre>
</div>
<pre><code>stan_lmer
 family:       gaussian [identity]
 formula:      course ~ female + (1 | school)
 observations: 1725
------
            Median MAD_SD
(Intercept) 69.7    1.3  
femaleF      6.7    0.7  

Auxiliary parameter(s):
      Median MAD_SD
sigma 13.4    0.2  

Error terms:
 Groups   Name        Std.Dev.
 school   (Intercept)  9      
 Residual             13      
Num. levels: school 73 

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
</div>
<p>Merk op dat in plaats van de standaard priors in <code>stan_lmer</code>, <span class="math inline">\(\mu_{\alpha}\)</span> en <span class="math inline">\(\beta\)</span> normale prior verdelingen krijgen met gemiddelde 0 en standaardafwijking 100 door de argumenten <code>prior</code> en <code>prior_intercept</code> op te geven als <code>normal(location = 0, scale = 100, autoscale = FALSE)</code>. Om te voorkomen dat <code>stan_lmer</code> de prior schaalt, moeten we ervoor zorgen dat het argument <code>autoscale = FALSE</code> wordt toegevoegd.</p>
<p>De puntschattingen van <span class="math inline">\(_mu_{alpha}\)</span>, <span class="math inline">\(\beta\)</span>, en <span class="math inline">\(\sigma_{y}\)</span> zijn bijna identiek aan de ML-schattingen van de <code>lmer()</code> fit. Echter, deels omdat ML de onzekerheid over <span class="math inline">\(\mu_{alpha}\)</span> negeert bij het schatten van <span class="math inline">\(\sigma_{alpha}\)</span>, is de Bayesiaanse schatting voor <span class="math inline">\(\sigma_{alpha}\)</span> (<span class="math inline">\(9,0\)</span>) groter dan de ML-schatting (<span class="math inline">\(8,8\)</span>), net als bij model 1.</p>
<h3 id="model-3-variërende-slopes-over-scholen-toevoegen">Model 3: Variërende slopes over scholen toevoegen</h3>
<p>We also use <code>stan_lmer</code> to fit Model 3 using the command below. Note that here, we use the default priors which are mostly similar to what was done in Model 1. Additionally, we are also required to specify a prior for the covariance matrix <span class="math inline">\(\Sigma\)</span> for <span class="math inline">\(\alpha_j\)</span> and <span class="math inline">\(\beta_j\)</span> in this Model. <code>stan_lmer</code> decomposes this covariance matrix (up to a factor of <span class="math inline">\(\sigma_y\)</span>) into (i) a correlation matrix <span class="math inline">\(R\)</span> and (ii) a matrix of variances <span class="math inline">\(V\)</span>, and assigns them separate priors as shown below.</p>
<p><span class="math display">\[
\begin{aligned}
\Sigma &amp;= 
\left(\begin{matrix} 
\sigma_\alpha^2 &amp; \rho\sigma_\alpha \sigma_\beta \\ 
\rho\sigma_\alpha\sigma_\beta&amp;\sigma_\beta^2 
\end{matrix} \right)\\ &amp;= 
\sigma_y^2\left(\begin{matrix} 
\sigma_\alpha^2/\sigma_y^2 &amp; \rho\sigma_\alpha \sigma_\beta/\sigma_y^2 \\ 
\rho\sigma_\alpha\sigma_\beta/\sigma_y^2 &amp; \sigma_\beta^2/\sigma_y^2 
\end{matrix} \right)\\ &amp;= 
\sigma_y^2\left(\begin{matrix} 
\sigma_\alpha/\sigma_y &amp; 0 \\ 
0&amp;\sigma_\beta/\sigma_y
\end{matrix} \right)
\left(\begin{matrix} 
1 &amp; \rho\\ 
\rho&amp;1 
\end{matrix} \right)
\left(\begin{matrix} 
\sigma_\alpha/\sigma_y &amp; 0 \\ 
0&amp;\sigma_\beta/\sigma_y 
\end{matrix} \right)\\ 
&amp;= \sigma_y^2VRV.
\end{aligned}
\]</span></p>
<p>De correlatiematrix <span class="math inline">\(R\)</span> is een 2 bij 2 matrix met 1-en op de diagonaal en <span class="math inline">\(rho\)</span>’s op de off-diagonaal. <code>stan_lmer</code> kent er een LKJ^[Voor meer details over de LKJ verdeling, zie <a href="http://www.psychstatistics.com/2014/12/27/d-lkj-priors/">hier</a> en <a href="http://mc-stan.org/users/documentation/case-studies/lotka-volterra-predator-prey.html">hier</a> prior aan toe, met regularisatieparameter 1 (Lewandowski et all., 2009). Dit komt overeen met het toekennen van een uniforme prior voor <span class="math inline">\(rho\)</span>. Hoe groter de regularisatieparameter is dan 1, hoe meer de verdeling voor <span class="math inline">\(\rho\)</span> de waarde 0 aanneemt.</p>
<p>De matrix van (geschaalde) varianties <span class="math inline">\(V\)</span> kan eerst worden samengevat in een vector van (geschaalde) varianties, en vervolgens ontleed in drie delen, <span class="math inline">\(J\)</span>, <span class="math inline">\(\tau^2\)</span> en <span class="math inline">\(\pi\)</span> zoals hieronder getoond. <span class="math display">\[
\left(\begin{matrix} 
\sigma_\alpha^2/\sigma_y^2 \\ 
\sigma_\beta^2/\sigma_y^2 
\end{matrix} \right) = 
2\left(\frac{\sigma_\alpha^2/\sigma_y^2 + \sigma_\beta^2/\sigma_y^2}{2}\right)\left(\begin{matrix} 
\frac{\sigma_\alpha^2/\sigma_y^2}{\sigma_\alpha^2/\sigma_y^2 + \sigma_\beta^2/\sigma_y^2} \\ 
\frac{\sigma_\beta^2/\sigma_y^2}{\sigma_\alpha^2/\sigma_y^2 + \sigma_\beta^2/\sigma_y^2} 
\end{matrix} \right)=
J\tau^2 \pi. 
\]</span><br />
In deze formulering is <span class="math inline">\(J\)</span> het aantal variërende effecten in het model (hier <span class="math inline">\(J=2\)</span>), kan <span class="math inline">\(Jtau^2\)</span> worden beschouwd als een gemiddelde (geschaalde) variantie over de variërende effecten <span class="math inline">\(Jalpha_j\)</span> en <span class="math inline">\(Jbeta_j\)</span>, en is <span class="math inline">\(Jpi\)</span> een niet-negatieve vector die sommeert tot 1 (een zogenaamde simplex/probabiliteitsvector). Een symmetrische Dirichlet<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> verdeling met concentratieparameter ingesteld op 1 wordt dan gebruikt als de prior voor <span class="math inline">\(\pi\)</span>. Standaard impliceert dit een gezamenlijk uniforme prior over alle simplexvectoren van dezelfde grootte. Een schaalinvariante Gamma-voorrang met vorm- en schaalparameters beide op 1 wordt dan toegekend voor <span class="math inline">\(\tau\)</span>. Dit komt overeen met het toekennen van de exponentiële verdeling met de snelheidsparameter op 1 die consistent is met de prioriteit toegekend aan <span class="math inline">\(\sigma_y\)</span> als prioriteit.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>M3_stanlmer</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://mc-stan.org/rstanarm/reference/stan_glmer.html'>stan_lmer</a></span><span class='op'>(</span>formula <span class='op'>=</span> <span class='va'>course</span> <span class='op'>~</span> <span class='va'>female</span> <span class='op'>+</span> <span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='va'>female</span> <span class='op'>|</span> <span class='va'>school</span><span class='op'>)</span>, 
                         data <span class='op'>=</span> <span class='va'>GCSE</span>,
                         seed <span class='op'>=</span> <span class='fl'>349</span><span class='op'>)</span>
<span class='fu'><a href='https://mc-stan.org/rstanarm/reference/prior_summary.stanreg.html'>prior_summary</a></span><span class='op'>(</span>object <span class='op'>=</span> <span class='va'>M3_stanlmer</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Priors for model &#39;M3_stanlmer&#39; 
------
Intercept (after predictors centered)
  Specified prior:
    ~ normal(location = 73, scale = 2.5)
  Adjusted prior:
    ~ normal(location = 73, scale = 41)

Coefficients
  Specified prior:
    ~ normal(location = 0, scale = 2.5)
  Adjusted prior:
    ~ normal(location = 0, scale = 83)

Auxiliary (sigma)
  Specified prior:
    ~ exponential(rate = 1)
  Adjusted prior:
    ~ exponential(rate = 0.061)

Covariance
 ~ decov(reg. = 1, conc. = 1, shape = 1, scale = 1)
------
See help(&#39;prior_summary.stanreg&#39;) for more details</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>M3_stanlmer</span>
</code></pre>
</div>
<pre><code>stan_lmer
 family:       gaussian [identity]
 formula:      course ~ female + (1 + female | school)
 observations: 1725
------
            Median MAD_SD
(Intercept) 69.4    1.3  
femaleF      7.1    1.1  

Auxiliary parameter(s):
      Median MAD_SD
sigma 13.0    0.2  

Error terms:
 Groups   Name        Std.Dev. Corr 
 school   (Intercept) 10.3          
          femaleF      7.2     -0.49
 Residual             13.0          
Num. levels: school 73 

------
* For help interpreting the printed output see ?print.stanreg
* For info on the priors used see ?prior_summary.stanreg</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Hier zien we dat de puntschattingen voor <span class="math inline">\(\mu_{\alpha}\)</span> en <span class="math inline">\(\sigma_{y}\)</span> identiek zijn aan de ML-schattingen uit <code>lmer()</code> fit. De puntschatting voor $<span class="math inline">\(_bèta\)</span> is iets anders in dit model (7.14 vergeleken met 7.13). Verder is, net als bij de vorige twee modellen, de Bayesiaanse schatting voor <span class="math inline">\(\sigma_{\alpha}\)</span> (10.3) groter dan de ML schatting (10.15). Daarnaast zijn de Bayesiaanse schattingen voor <span class="math inline">\(\sigma_{\beta}\)</span> (7.2) en <span class="math inline">\(\rho\)</span> (-0.49) groter dan de overeenkomstige ML schattingen (respectievelijk 6.92 en -0.52).</p>
<h1 id="evalueren-van-model-convergentie">Evalueren van model convergentie</h1>
<div class="layout-chunk" data-layout="l-body">
<p><img src="multilevelrstan_files/figure-html5/unnamed-chunk-37-1.png" width="288" /></p>
</div>
<p>Standaard zullen alle <strong>rstanarm</strong> modelleerfuncties 4 willekeurig geïnitialiseerde Markov-ketens laten lopen, elk gedurende 2000 iteraties (inclusief een opwarmperiode van 1000 iteraties). Alle ketens moeten naar de doelverdeling convergeren om geldige conclusies te kunnen trekken. De diagnostica die wij gebruiken om te beoordelen of de ketens naar de posterior verdeling zijn geconvergeerd, zijn de statistieken <span class="math inline">\(\hat{R}\)</span> en <span class="math inline">\(N_{text{eff}}\)</span> <span class="citation" data-cites="gelman1992inference">[@gelman1992inference]</span>. Aan elke parameter zijn de statistiek <span class="math inline">\(\hat{R}\)</span> en <span class="math inline">\(N_{text{eff}}\)</span> verbonden. Zoals eerder gezien, worden deze statistieken automatisch gegenereerd bij gebruik van de <code>summary</code> methode.</p>
<p>De <span class="math inline">\(\hat{R}\)</span> is in wezen de verhouding tussen-keten variantie en binnen-keten variantie analoog aan ANOVA. De statistiek <span class="math inline">\(\hat{R}\)</span> zou kleiner dan 1,1 moeten zijn als de ketens zijn geconvergeerd. Om een plot te zien van de <span class="math inline">\(\hat{R}\)</span> waarden over de parameters kunnen we de <code>plot</code> methode gebruiken voor <code>stanreg</code> object <code>M1_stanlmer</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>M1_stanlmer</span>, <span class='st'>"rhat"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>M1_stanlmer</span>, <span class='st'>"ess"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>De statistiek <span class="math inline">\(N_{text{eff}}\)</span> geeft het effectieve aantal trekkingen van de simulatie weer. Als de trekkingen onafhankelijk zouden zijn, zou <span class="math inline">\(N_{text{eff}}\)</span> het aantal opgeslagen trekkingen zijn, 4.000 (4 ketens $ maal$ (2.000 iteraties - 1.000 iteraties voor warmup)), maar <span class="math inline">\(N_{text{eff}}\)</span> is meestal kleiner dan 4.000 omdat Markov chain simulaties de neiging hebben autocorrelatie te vertonen. De <span class="math inline">\(N_{text{eff}}\)</span> statistiek zou typisch minstens 100 moeten zijn voor alle parameters. We kunnen een histogram plotten van de verhouding tussen de effectieve steekproefgrootte en de totale steekproefgrootte:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>M1_stanlmer</span>, <span class='st'>"ess"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h1 id="literatuur">Literatuur</h1>
<p>Browne, William J, David Draper, and others. 2006. “A Comparison of Bayesian and Likelihood-Based Methods for Fitting Multilevel Models.” <em>Bayesian Analysis 1 (3)</em>: 473–514.</p>
<p>Gelman, Andrew, and Jennifer Hill. 2006. <em>Data Analysis Using Regression and Multilevel/Hierarchical Models</em>. Cambridge University Press.</p>
<p>Gelman, Andrew, and Donald B Rubin. 1992. “Inference from Iterative Simulation Using Multiple Sequences.” <em>Statistical Science. JSTOR</em>, 457–72.</p>
<p>Goldstein, Harvey, and David J Spiegelhalter. 1996. “League Tables and Their Limitations: Statistical Issues in Comparisons of Institutional Performance.” <em>Journal of the Royal Statistical Society. Series A (Statistics in Society)</em>, 385–443.</p>
<p>Lewandowski, Daniel, Dorota Kurowicka, and Harry Joe. 2009. “Generating Random Correlation Matrices Based on Vines and Extended Onion Method.” <em>Journal of Multivariate Analysis 100 (9)</em>. Elsevier: 1989–2001.</p>
<p>Rasbash, Jon, William Browne, Harvey Goldstein, Min Yang, Ian Plewis, Michael Healy, Geoff Woodhouse, David Draper, Ian Langford, and Toby Lewis. 2000. “<em>A User’s Guide to Mlwin.</em>” University of London, Institute of Education, Centre for Multilevel Modelling.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>We werken meer over prioriteitsverdelingen uit in hoofdstuk 3. 2<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>Gebruikers die niet vertrouwd zijn met de syntaxis van <strong>ggplot2</strong> verwijzen we naar <a href="https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf">hier</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>Voor meer informatie over reguliere expressies, zie <a href="http://www.rstudio.com/wp-content/uploads/2016/09/RegExCheatsheet.pdf">hier</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>De Dirichlet-verdeling is een multivariate veralgemening van de bètaverdeling met één concentratieparameter, die kan worden geïnterpreteerd als voorafgaande tellingen van een multinomiale willekeurige variabele (de simplexvector in onze context), zie voor details <a href="https://cran.r-project.org/web/packages/rstanarm/vignettes/glmer.html#details">hier</a>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
